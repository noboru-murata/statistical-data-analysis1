<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>データの整理と集計</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/menu.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/font-awesome/css/fontawesome.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/chalkboard/style.css"/>

<link rel="stylesheet" href="./reveal.js/local/mycourse.css"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">データの整理と集計</h1>
</div>
<div class="talk-subtitle">
    <p>第4講 - データフレームのより進んだ操作</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>
<section>
<section id="slide-orgfb68a38">
<h2 id="orgfb68a38">講義概要</h2>
<ul>
<li>データフレームの操作</li>
<li>ファイルの取り扱い</li>
<li>データの集計</li>

</ul>
</section>
</section>
<section>
<section id="slide-orge1ac957">
<h2 id="orge1ac957">データフレームの操作</h2>
<div class="outline-text-2" id="text-orge1ac957">
</div>
</section>
<section id="slide-org80e7181">
<h3 id="org80e7181">データ構造</h3>
<ul>
<li>Rに用意されている基本的なデータ構造
<ul>
<li>ベクトル (<code>vector</code>) : 1次元配列</li>
<li>行列 (<code>matrix</code>) : 2次元配列</li>
<li>配列 (<code>array</code>) : 多次元配列</li>
<li><b>データフレーム</b> (<code>data.frame</code>, <code>tibble</code>) : 表 (2次元配列)</li>

</ul></li>
<li>特殊なもの
<ul>
<li>リスト (<code>list</code>) : オブジェクトの集合</li>

</ul></li>

</ul>
</section>
<section id="slide-orgcb19739">
<h3 id="orgcb19739">データフレーム</h3>
<ul>
<li>複数の個体について，いくつかの属性を集計した表
<ul>
<li>長さの等しい列ベクトルをまとめたもの</li>
<li>各列のデータ型はバラバラでも良い</li>

</ul></li>
<li><p>
<span style="color:green;">データフレームの例</span>
</p>
<blockquote>
<p>
ある小学校の1年生の身長・体重・性別・血液型のデータ
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">名前</th>
<th scope="col" class="org-right">身長 [cm]</th>
<th scope="col" class="org-right">体重 [kg]</th>
<th scope="col" class="org-left">性別</th>
<th scope="col" class="org-left">血液型</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">太郎</td>
<td class="org-right">108</td>
<td class="org-right">19</td>
<td class="org-left">男</td>
<td class="org-left">B</td>
</tr>

<tr>
<td class="org-left">花子</td>
<td class="org-right">116</td>
<td class="org-right">21</td>
<td class="org-left">女</td>
<td class="org-left">O</td>
</tr>

<tr>
<td class="org-left">次郎</td>
<td class="org-right">130</td>
<td class="org-right">25</td>
<td class="org-left">男</td>
<td class="org-left">AB</td>
</tr>

<tr>
<td class="org-left">&#x2026;</td>
<td class="org-right">&#x2026;</td>
<td class="org-right">&#x2026;</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">&#x2026;</td>
</tr>
</tbody>
</table>
</blockquote></li>
<li>(特殊な) <b>行列</b> でもあり <b>リスト</b> でもある</li>

</ul>
</section>
<section id="slide-org13f5379">
<h3 id="org13f5379">tidyverse パッケージ</h3>
<ul>
<li>データ操作とグラフィクスの拡張 (再掲)
<ul>
<li><b>tidyverse</b> : Hadley Wickham @posit による拡張パッケージ集
<ul>
<li><a href="https://www.tidyverse.org/packages/">https://www.tidyverse.org/packages/</a></li>
<li><a href="https://tidyverse.tidyverse.org/">https://tidyverse.tidyverse.org/</a></li>

</ul></li>

</ul></li>
<li><p>
パッケージ集の利用には以下が必要 
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#26368;&#21021;&#12395;&#19968;&#24230;&#12384;&#12369;&#20197;&#19979;&#12398;&#12356;&#12378;&#12428;&#12363;&#12434;&#23455;&#34892;&#12375;&#12390;&#12362;&#12367;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;">  - Package &#12479;&#12502;&#12363;&#12425; tidyverse &#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;">  - &#12467;&#12531;&#12477;&#12540;&#12523;&#19978;&#12391;&#27425;&#12398;&#12467;&#12510;&#12531;&#12489;&#12434;&#23455;&#34892; 'install.packages("tidyverse")'</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> tidyverse &#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
<span style="color: #60aa00;">library</span>(tidyverse)
</pre>
</div></li>
<li>データフレームの拡張である <code>tibble</code> を利用</li>

</ul>
</section>
<section id="slide-orgc34bc0a">
<h3 id="orgc34bc0a">データ例</h3>
<ul>
<li><p>
<b><code>datasets::airquality</code></b>
</p>
<blockquote>
<p>
<span style="color:green;">New York Air Quality Measurements</span>
</p>
<ul>
<li>Description:
Daily air quality measurements in New York, May to September 1973.</li>
<li>Format: 
A data frame with 153 observations on 6 variables.
<ul>
<li>[,1]   Ozone   numeric Ozone (ppb)</li>
<li>[,2]   Solar.R numeric Solar R (lang)</li>
<li>[,3]   Wind    numeric Wind (mph)</li>
<li>[,4]   Temp    numeric Temperature (degrees F)</li>
<li>[,5]   Month   numeric Month (1&#x2013;12)</li>
<li>[,6]   Day     numeric Day of month (1&#x2013;31)</li>

</ul></li>

</ul>
</blockquote>
<ul>
<li>&rsquo;<code>?airquality</code>&rsquo; で詳細を確認</li>
<li><code>datasets</code> はRの標準パッケージ</li>
<li><b>パッケージ名::オブジェクト</b> という書き方で同名のオブジェクトを区別</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
<code>tibble</code> 形式への変換
</p>
<div class="org-src-container">

<pre class="src src-R">aq_tbl <span style="color: #60aa00;">&lt;-</span> as_tibble(airquality) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">tibble &#24418;&#24335;&#12408;&#22793;&#25563;</span>
aq_df <span style="color: #60aa00;">&lt;-</span> airquality <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#27604;&#36611;&#12398;&#12383;&#12417; data.frame &#12434;&#21029;&#21517;&#12391;&#23450;&#32681; (&#12467;&#12500;&#12540;)</span>
aq_tbl <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26368;&#21021;&#12398;10&#34892;&#12398;&#12415;&#34920;&#31034;&#12373;&#12428;&#12427;</span>
aq_df  <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20840;&#12390;&#12398;&#12487;&#12540;&#12479;&#12364;&#34920;&#31034;&#12373;&#12428;&#12427;</span>
print(aq_tbl, n = 15)  <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26368;&#21021;&#12398;15&#34892;&#12364;&#34920;&#31034;&#12373;&#12428;&#12427;&#65294;'?tibble::print.tbl' &#12434;&#21442;&#29031;</span>
print(aq_tbl, n = <span style="color: #00aa80;">Inf</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20840;&#12390;&#34920;&#31034;</span>
head(aq_df, n = 10)    <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26368;&#21021;&#12398;10&#34892;&#12364;&#34920;&#31034;&#12373;&#12428;&#12427;&#65294;tibble&#12391;&#12418;&#21516;&#27096;</span>
tail(aq_df, n = 10)    <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26368;&#24460;&#12398;10&#34892;&#12364;&#34920;&#31034;&#12373;&#12428;&#12427;&#65294;tibble&#12391;&#12418;&#21516;&#27096;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org10ab2b7">
<h3 id="org10ab2b7">項目の抽出</h3>
<ul>
<li><p>
添字の番号(行と列)を指定
</p>
<ul>
<li>要素の名前で指定</li>
<li><b>除外</b> : マイナス記号(-)をつけて指定</li>
<li>論理値で指定
<ul>
<li><code>TRUE</code> : 要素の <b>選択</b></li>
<li><code>FALSE</code> : 要素の <b>除外</b></li>

</ul></li>

</ul>
<div class="org-src-container">

<pre class="src src-R">aq_tbl[1,2] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">1&#34892;2&#21015;&#12398;&#35201;&#32032;&#12434;&#36984;&#25246;</span>
aq_tbl[-seq(2, nrow(aq_tbl), by = 2),] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20598;&#25968;&#34892;&#12434;&#38500;&#22806;</span>
aq_tbl[,c(<span style="color: #00aa80;">TRUE</span>,<span style="color: #00aa80;">FALSE</span>,<span style="color: #00aa80;">TRUE</span>,<span style="color: #00aa80;">TRUE</span>,<span style="color: #00aa80;">FALSE</span>,<span style="color: #00aa80;">TRUE</span>)] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">1,3,4,6&#21015;&#12434;&#36984;&#25246;</span>
aq_tbl[<span style="color: #d08928;">"Ozone"</span>] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">Ozone&#21015;&#12434;&#36984;&#25246;&#65294;aq_tbl[,"Ozone"] &#12391;&#12418;&#21516;&#27096;</span>
aq_tbl[c(<span style="color: #d08928;">"Ozone"</span>,<span style="color: #d08928;">"Wind"</span>)] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#35079;&#25968;&#21015;&#12398;&#36984;&#25246;&#12418;&#21516;&#27096;</span>
aq_tbl[[<span style="color: #d08928;">"Ozone"</span>]] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12522;&#12473;&#12488;&#12392;&#12375;&#12390;&#25201;&#12356;1&#21015;&#12434;&#36984;&#25246;&#12377;&#12427;&#12392;&#12505;&#12463;&#12488;&#12523;&#12395;&#12394;&#12427;</span>
aq_tbl$Ozone      <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21516;&#19978;</span>
</pre>
</div></li>
<li><b>欠損値 <code>NA</code></b> の扱いは状況依存なので注意
<ul>
<li><code>NA</code> : 値が得られていないことを表すスカラー値(論理値)</li>

</ul></li>

</ul>
</section>
<section id="slide-orge98275a">
<h3 id="orge98275a">行の選択 (素朴な方法)</h3>
<ul>
<li><p>
行番号による指定
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#34892;&#30058;&#21495;&#12398;&#12505;&#12463;&#12488;&#12523;&#12391;&#25351;&#23450;&#12375;&#12390;&#25277;&#20986;</span>
aq_tbl[20:30,] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">20-30&#34892;&#12434;&#25277;&#20986;</span>
</pre>
</div></li>
<li><p>
条件の指定
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#26465;&#20214;&#12398;&#25351;&#23450;&#12398;&#20181;&#26041;</span>
aq_tbl[1:15,]$Ozone &gt; 100 <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26465;&#20214;&#12395;&#21512;&#33268;&#12377;&#12427;&#34892;&#12399;TRUE (NA&#12399;&#27424;&#25613;&#20516;)</span>
aq_tbl[1:15,]$Ozone &gt; 100 &amp; aq_tbl[1:15,]$Wind &lt;= 5 <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26465;&#20214;&#12398;AND</span>
with(aq_tbl[1:15,], Ozone &gt; 100 &amp; Wind &lt;= 5) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#19978;&#12392;&#21516;&#12376;(&#30701;&#12356;&#26360;&#12365;&#26041;)</span>
with(aq_tbl[1:60,], Ozone &gt; 100 | Wind &lt;= 5) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26465;&#20214;&#12398;OR</span>
</pre>
</div></li>
<li><p>
条件に合致する行の抽出
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#38306;&#25968; which() &#12391;TRUE&#12392;&#12394;&#12427;&#34892;&#30058;&#21495;&#12434;&#25277;&#20986;&#12375;&#12390;&#25351;&#23450;</span>
which(with(aq_tbl, Ozone&gt;100 &amp; Wind&lt;=5)) 
aq_tbl[which(with(aq_tbl, Ozone&gt;100 &amp; Wind&lt;=5)), ] 
</pre>
</div></li>

</ul>
</section>
<section id="slide-orgcdaced6">
<h3 id="orgcdaced6">列の選択 (素朴な方法)</h3>
<ul>
<li><p>
列番号による指定
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#21015;&#30058;&#21495;&#12398;&#12505;&#12463;&#12488;&#12523;&#12391;&#25351;&#23450;&#12375;&#12390;&#25277;&#20986;</span>
aq_tbl[which(with(aq_tbl, Ozone&gt;100 &amp; Wind &lt;= 5)), c(1,5,6)] 
</pre>
</div></li>
<li><p>
列名による指定
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35079;&#25968;&#12398;&#21015;&#12398;&#22580;&#21512;</span>
aq_tbl[which(with(aq_tbl, Ozone &gt; 100 &amp; Wind &lt;= 5)), c(<span style="color: #d08928;">"Month"</span>,<span style="color: #d08928;">"Day"</span>)] 
</pre>
</div></li>
<li><p>
列名による指定 (1つの場合)
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> 1&#12388;&#12398;&#21015;&#12398;&#22580;&#21512;&#12399;&#12522;&#12473;&#12488;&#12398;&#25805;&#20316;&#12392;&#12375;&#12390;&#21462;&#12426;&#20986;&#12379;&#12427;&#12364;&#65292;&#12505;&#12463;&#12488;&#12523;&#12392;&#12394;&#12427;&#12371;&#12392;&#12395;&#27880;&#24847;</span>
aq_tbl[which(with(aq_tbl, Ozone &gt; 100 &amp; Wind &lt;= 5)),]$Month  <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12505;&#12463;&#12488;&#12523;</span>
aq_tbl[which(with(aq_tbl, Ozone &gt; 100 &amp; Wind &lt;= 5)),][[<span style="color: #d08928;">"Month"</span>]] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21516;&#19978;</span>
aq_tbl[which(with(aq_tbl, Ozone &gt; 100 &amp; Wind &lt;= 5)),<span style="color: #d08928;">"Month"</span>] <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org2af1c31">
<h3 id="org2af1c31">行の選択</h3>
<ul>
<li><p>
関数 <code>dplyr::filter()</code> : 条件を指定して行を選択
</p>
<div class="org-src-container">

<pre class="src src-R">filter(.data, ..., .by = <span style="color: #00aa80;">NULL</span>, .preserve = <span style="color: #00aa80;">FALSE</span>)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512; </span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ...: &#34892;&#12395;&#38306;&#12377;&#12427;&#26465;&#20214;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .by: &#12464;&#12523;&#12540;&#12503;&#21270;&#12434;&#25351;&#23450;(&#23455;&#39443;&#30340;&#12394;&#23455;&#35013;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .preserve: &#12464;&#12523;&#12540;&#12503;&#21270;&#12434;&#32173;&#25345;&#12377;&#12427;&#12363;&#25351;&#23450;(&#23455;&#39443;&#30340;&#12394;&#23455;&#35013;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?dplyr::filter' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>
<li>行に関する条件指定には以下を用いることができる
<ul>
<li>等号 : <code>==</code> (否定は <code>!=</code>)</li>
<li>不等号 : <code>&lt;,&gt;,&lt;=,&gt;=</code></li>
<li>論理式 : <code>&amp;</code> (かつ), <code>|</code> (または)</li>

</ul></li>

</ul>
</section>
<section id="slide-org7fea145">
<h3 id="org7fea145">列の選択</h3>
<ul>
<li><p>
関数 <code>dplyr::select()</code> : 条件を指定して列を選択
</p>
<div class="org-src-container">

<pre class="src src-R">select(.data, ...)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512; </span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ...: &#21015;&#12395;&#38306;&#12377;&#12427;&#26465;&#20214;(&#21015;&#12398;&#30058;&#21495;&#65292;&#21517;&#21069;&#65292;&#21517;&#21069;&#12395;&#38306;&#12377;&#12427;&#26465;&#20214;&#24335;&#12434;&#21033;&#29992;&#12377;&#12427;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?dplyr::select' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>
<li>条件指定には例えば以下のような方法がある
<ul>
<li>含めない : <code>!列名</code>, <code>!c(列名,列名,...)</code>, <code>!(列名:列名)</code></li>
<li>特定の文字列で始まる : <code>starts_with("文字列")</code></li>
<li>特定の文字列で終わる : <code>ends_with("文字列")</code>,</li>
<li>組み合わせ : <code>&amp;</code> (かつ), <code>|</code> (または)</li>

</ul></li>

</ul>
</section>
<section id="slide-orgf444355">
<h3 id="orgf444355">パイプ演算子</h3>
<ul>
<li>処理を順次結合する演算子 (いくつか定義がある)
<ul>
<li><code>|&gt;</code> (base R で定義; この講義ではこちらで記述する)</li>
<li><code>%&gt;%</code> (<code>package::magrittr</code>)</li>

</ul></li>
<li><p>
<span style="color:green;">データフレームの部分集合の取得</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32032;&#26420;&#12398;&#26041;&#27861;&#12398;&#20363;&#12399;&#20197;&#19979;&#12398;&#12424;&#12358;&#12395;&#26360;&#12369;&#12427;</span>
aq_tbl |&gt; filter(Ozone &gt; 100 &amp; Wind &lt;= 5) |&gt; select(1,5,6)
aq_tbl |&gt; filter(Ozone &gt; 100 &amp; Wind &lt;= 5) |&gt; select(Month,Day)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> Ozone&#12395;&#27424;&#28204;(NA)&#12364;&#12394;&#12367;, &#12363;&#12388;Day&#12364;5&#12363;10&#12398;&#12487;&#12540;&#12479;&#12398;Wind&#12363;&#12425;Day&#12414;&#12391;&#12398;&#21015;&#12434;&#25277;&#20986;</span>
aq_tbl |&gt; filter(!is.na(Ozone) &amp; Day <span style="color: #60aa00;">%in%</span> c(5,10)) |&gt; select(Wind:Day)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> Ozone&#12364;120&#20197;&#19978;&#12363;&#65292;&#12414;&#12383;&#12399;Wind&#12364;3&#20197;&#19979;&#12398;Temp&#20197;&#22806;&#12398;&#21015;&#12434;&#25277;&#20986;</span>
aq_tbl |&gt; filter(Ozone &gt; 120 | Wind &lt;= 3) |&gt; select(!Temp)
</pre>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-org15ba739" data-background="#fef4f4">
<h2 id="org15ba739">実習</h2>
</section>
<section id="slide-org803a32e" data-background="#fef4f4">
<h3 id="org803a32e">練習問題</h3>
<ul>
<li><code>datasets::airquality</code> に対して
以下の条件を満たすデータを取り出しなさい．
<ul>
<li>7月のオゾン濃度 (<code>Ozone</code>)</li>
<li>風速 (<code>Wind</code>) が時速10マイル以上で，
かつ気温 (<code>Temp</code>) が華氏80度以上の日のデータ</li>
<li>オゾン (<code>Ozone</code>) も日射量 (<code>Solar.R</code>) も
欠測 (<code>NA</code>) でないデータの月 (<code>Month</code>) と日 (<code>Day</code>)</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org138ca8f">
<h2 id="org138ca8f">ファイルの取り扱い</h2>
<div class="outline-text-2" id="text-org138ca8f">
</div>
</section>
<section id="slide-orgb518e5c">
<h3 id="orgb518e5c">データファイルの読み書き</h3>
<ul>
<li>実際の解析においては以下の操作が必要
<ul>
<li>収集されたデータを読み込む</li>
<li>整理したデータを保存する</li>

</ul></li>
<li>Rで利用可能なデータファイル
<ul>
<li>CSV形式 (comma separated values) : テキストファイル</li>
<li>RData形式 : Rの内部表現を用いたバイナリーファイル</li>
<li><span style="color:gray;">Excel形式 : RStudio の読み込み機能が利用可能</span></li>

</ul></li>
<li>データフレームを対象とした扱いを整理する</li>

</ul>
</section>
<section id="slide-org373c290">
<h3 id="org373c290">作業ディレクトリ</h3>
<ul>
<li>Rの処理は <b>作業ディレクトリ</b> で実行される
<ul>
<li>ファイルは作業ディレクトリに存在するものとして扱われる</li>
<li>それ以外のファイルを扱う場合はパスを含めて指定する</li>

</ul></li>
<li>作業ディレクトリの確認
<ul>
<li>コンソールの上部の表示</li>
<li>関数 <code>getwd()</code></li>

</ul></li>
<li>作業ディレクトリの変更
<ul>
<li><b>Session</b> メニューの <b>Set Working Directory</b> で指定
<ul>
<li>読み込んだファイルの場所を選択</li>
<li>Files Pane の場所を選択</li>
<li>ディレクトリを直接選択</li>

</ul></li>
<li>関数 <code>setwd()</code></li>

</ul></li>
<li>プロジェクトでは適切に設定される</li>

</ul>
</section>
<section id="slide-org060cfd0">
<h3 id="org060cfd0">作業ディレクトリの操作</h3>
<ul>
<li><p>
関数 <code>base::getwd()</code> : 作業ディレクトリの確認
</p>
<div class="org-src-container">

<pre class="src src-R">getwd() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#29872;&#22659;&#12395;&#12424;&#12387;&#12390;&#23455;&#34892;&#32080;&#26524;&#12399;&#30064;&#12394;&#12427;</span>
</pre>
</div>
<ul>
<li>作業ディレクトリはコンソールのタブにも表示されている</li>

</ul></li>
<li><p>
関数 <code>base::setwd()</code> : 作業ディレクトリの変更
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #60aa00;">setwd</span>(<span style="color: #d08928;">"~/Documents"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12507;&#12540;&#12512;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#19979;&#12398;&#12300;&#26360;&#39006;&#12301;&#12501;&#12457;&#12523;&#12480;&#12395;&#31227;&#21205;</span>
</pre>
</div>
<ul>
<li>環境によって指定の仕方は異なる</li>

</ul></li>

</ul>
</section>
<section id="slide-orgfec4f48">
<h3 id="orgfec4f48">CSV ファイルの操作</h3>
<ul>
<li><p>
関数 <code>readr::write_csv()</code> : ファイルの書き出し
</p>
<div class="org-src-container">

<pre class="src src-R">write_csv(x,         <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
          file, ...) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#21517;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32048;&#12363;&#12394;&#12458;&#12503;&#12471;&#12519;&#12531;&#12395;&#12388;&#12356;&#12390;&#12399; '?readr::write_csv' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>
<li><p>
関数 <code>readr::read_csv()</code> : ファイルの読み込み
</p>
<div class="org-src-container">

<pre class="src src-R">read_csv(file, ...) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#21517;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32048;&#12363;&#12394;&#12458;&#12503;&#12471;&#12519;&#12531;&#12395;&#12388;&#12356;&#12390;&#12399; '?readr::read_csv' &#12434;&#21442;&#29031;</span>
</pre>
</div>
<ul>
<li><code>tibble</code> クラスとして読み込まれる</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">書き出しの例</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#38306;&#25968; write_csv() &#12398;&#20351;&#12356;&#26041; (CSV&#12501;&#12449;&#12452;&#12523;&#12398;&#25805;&#20316;)</span>
my_data <span style="color: #60aa00;">&lt;-</span> <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#25972;&#29702;</span>
  aq_tbl |&gt; 
  filter(Ozone &gt; 80) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">Ozone &#12364;80&#12434;&#36234;&#12360;&#12427;&#26085;&#12434;&#25277;&#20986;</span>
  select(!Temp)          <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#28201;&#24230;&#12399;&#38500;&#12367;</span>
dim(my_data) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#22823;&#12365;&#12373;&#12434;&#30906;&#35469;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#20316;&#26989;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#20013;&#12395; data &#12392;&#12356;&#12358;&#12501;&#12457;&#12523;&#12480;&#12434;&#29992;&#24847;&#12375;&#12390;&#12362;&#12367;</span>
write_csv(my_data, <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20445;&#23384;&#12377;&#12427;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
          file = <span style="color: #d08928;">"data/my_data.csv"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">(&#22580;&#25152;&#12392;)&#12501;&#12449;&#12452;&#12523;&#21517;</span>
</pre>
</div></li>
<li><p>
<span style="color:green;">読み込みの例</span> 
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#38306;&#25968; read_csv() &#12398;&#20351;&#12356;&#26041; (CSV&#12501;&#12449;&#12452;&#12523;&#12398;&#25805;&#20316;)</span>
new_data <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/my_data.csv"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21069;&#12398;&#20363;&#12398;&#12501;&#12449;&#12452;&#12523;</span>
dim(new_data) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#27491;&#12375;&#12367;&#35501;&#12415;&#36796;&#12417;&#12383;&#12363;&#22823;&#12365;&#12373;&#12434;&#30906;&#35469;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org3d4bf12">
<h3 id="org3d4bf12">RData ファイルの操作</h3>
<ul>
<li><p>
関数 <code>base::save()</code> : ファイルの書き出し
</p>
<div class="org-src-container">

<pre class="src src-R">save(..., <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20445;&#23384;&#12377;&#12427;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488; (&#35079;&#25968;&#21487;&#65292;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#20197;&#22806;&#12418;&#21487;)</span>
     list = character(), <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20445;&#23384;&#12377;&#12427;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12398;&#21517;&#21069;(&#25991;&#23383;&#21015;)&#12391;&#12418;&#25351;&#23450;&#21487;&#33021;</span>
     file = <span style="color: #6c9ef8;">stop</span>(<span style="color: #d08928;">"'file' must be specified"</span>), ...) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#21517;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32048;&#12363;&#12394;&#12458;&#12503;&#12471;&#12519;&#12531;&#12395;&#12388;&#12356;&#12390;&#12399; '?base::save' &#12434;&#21442;&#29031;</span>
</pre>
</div>
<ul>
<li><b>複数</b> のオブジェクトをまとめて保存することができる</li>

</ul></li>
<li><p>
関数 <code>base::load()</code> : ファイルの読み込み
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #60aa00;">load</span>(file, ...) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#21517;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32048;&#12363;&#12394;&#12458;&#12503;&#12471;&#12519;&#12531;&#12395;&#12388;&#12356;&#12390;&#12399; '?base::load' &#12434;&#21442;&#29031;</span>
</pre>
</div>
<ul>
<li>同じ名前のオブジェクトがあると上書きするので注意</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">書き出しの例</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#38306;&#25968; save() &#12398;&#20351;&#12356;&#26041; (RData&#12501;&#12449;&#12452;&#12523;&#12398;&#25805;&#20316;)</span>
my_data_1 <span style="color: #60aa00;">&lt;-</span> aq_tbl |&gt; filter(Temp &gt; 90) |&gt; select(!Ozone)
my_data_2 <span style="color: #60aa00;">&lt;-</span> aq_tbl |&gt; filter(Temp &lt; 60) |&gt; select(!Ozone)
dim(my_data_1); dim(my_data_2) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#22823;&#12365;&#12373;&#12434;&#30906;&#35469;</span>
save(my_data_1, my_data_2, <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20445;&#23384;&#12377;&#12427;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#21015;&#25369;</span>
     file = <span style="color: #d08928;">"data/my_data.rdata"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#21517;</span>
</pre>
</div></li>
<li><p>
<span style="color:green;">読み込みの例</span> 
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#38306;&#25968; load() &#12398;&#20351;&#12356;&#26041; (RData&#12501;&#12449;&#12452;&#12523;&#12398;&#25805;&#20316;)</span>
my_data_1 <span style="color: #60aa00;">&lt;-</span> aq_tbl |&gt; filter(Ozone &gt; 160) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26032;&#12383;&#12395;&#20316;&#25104;</span>
<span style="color: #60aa00;">load</span>(file = <span style="color: #d08928;">"data/my_data.rdata"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12501;&#12449;&#12452;&#12523;&#21517;</span>
my_data_1 <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">save&#12375;&#12383;&#12392;&#12365;&#12398;&#21517;&#21069;&#12391;&#35501;&#12415;&#36796;&#12414;&#12428;&#19978;&#26360;&#12365;&#12373;&#12428;&#12427;</span>
my_data_2 
</pre>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-org07e6e44" data-background="#fef4f4">
<h2 id="org07e6e44">実習</h2>
</section>
<section id="slide-org2089c06" data-background="#fef4f4">
<h3 id="org2089c06">練習問題</h3>
<ul>
<li><p>
以下のデータを読み込んで操作してみよう
</p>
<blockquote>
<ul>
<li>データファイル (文字コード : utf8)
<ul>
<li>jpdata1.csv : 県別の対象データ</li>
<li>jpdata2.csv : 対象データの内容説明</li>
<li>jpdata3.csv : 県と地域の対応関係</li>

</ul></li>
<li><a href="https://www.e-stat.go.jp">https://www.e-stat.go.jp</a> より取得したデータ<br />
(地域から探す / 全県を選択 / 項目を選択してダウンロード)</li>

</ul>
</blockquote>
<ul>
<li><p>
作業ディレクトリの data 内に置いて読み込む
</p>
<div class="org-src-container">

<pre class="src src-R">jp_data <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata1.csv"</span>)
jp_item <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata2.csv"</span>)
jp_area <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata3.csv"</span>)
</pre>
</div></li>
<li><p>
日本語に問題がある場合は英語版を読み込む
</p>
<div class="org-src-container">

<pre class="src src-R">jp_data_en <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata1-en.csv"</span>)
jp_area_en <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata3-en.csv"</span>)
</pre>
</div></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgc826492">
<h2 id="orgc826492">データの集計</h2>
<div class="outline-text-2" id="text-orgc826492">
</div>
</section>
<section id="slide-org367c339">
<h3 id="org367c339">統計量の計算</h3>
<ul>
<li>データを集約した値 = 統計量
<ul>
<li>関数 <code>base::sum()</code> : 総和を計算する</li>
<li>関数 <code>base::mean()</code> : 平均</li>
<li>関数 <code>base::max()</code> : 最大値</li>
<li>関数 <code>base::min()</code> : 最小値</li>
<li>関数 <code>stats::median()</code> : 中央値</li>
<li>関数 <code>stats::quantile()</code> : 分位点</li>

</ul></li>
<li>これ以外にも沢山あるので調べてみよう</li>

</ul>
</section>
<section id="slide-org73e8a2f">
<h3 id="org73e8a2f">集約のための関数の使い方</h3>
<ul>
<li><p>
<span style="color:green;">データの集計の例</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32244;&#32722;&#21839;&#38988;&#12398;&#12487;&#12540;&#12479;&#12434;&#29992;&#12356;&#12427;</span>
sum(jp_data$&#20154;&#21475;)        <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20840;&#22269;&#12398;&#32207;&#20154;&#21475; (&#21015;&#21517;&#12391;&#12505;&#12463;&#12488;&#12523;&#12434;&#36984;&#25246;)</span>
sum(jp_data[,<span style="color: #d08928;">"&#20154;&#21475;"</span>])     <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">1&#21015;&#12398;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12392;&#12375;&#12390;&#35336;&#31639;</span>
jp_data |&gt; select(&#20154;&#21475;) |&gt; sum() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21516;&#19978;</span>
mean(jp_data[,5])       <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">1&#21015;&#12398;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12391;&#12399;&#12456;&#12521;&#12540;&#12395;&#12394;&#12427;</span>
mean(jp_data[[5]])      <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12505;&#12463;&#12488;&#12523;&#12392;&#12375;&#12390;&#25244;&#12365;&#20986;&#12377;&#24517;&#35201;&#12364;&#12354;&#12427;</span>
median(jp_data[[5]])    <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#38754;&#31309;&#12398;&#20013;&#22830;&#20516; (&#12522;&#12473;&#12488;&#12392;&#12375;&#12390;&#21015;&#12434;&#36984;&#25246;)</span>
jp_data |&gt; select(5) |&gt; median() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12394;&#12398;&#12391;&#21205;&#12363;&#12394;&#12356;</span>
min(jp_data[<span style="color: #d08928;">"&#33509;&#24180;"</span>])     <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#33509;&#24180;&#20154;&#21475;&#12398;&#26368;&#23567;&#20516; (&#21015;&#21517;&#12391;&#36984;&#25246;)</span>
jp_data |&gt; select(<span style="color: #d08928;">"&#33509;&#24180;"</span>) |&gt; min() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21516;&#19978;</span>
with(jp_data, max(&#32769;&#20154;)) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#32769;&#24180;&#20154;&#21475;&#12398;&#26368;&#22823;&#20516; (&#38306;&#25968; with() &#12434;&#21033;&#29992;)</span>
jp_data |&gt; select(<span style="color: #d08928;">"&#32769;&#20154;"</span>) |&gt; max() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21516;&#19978;</span>
</pre>
</div>
<ul>
<li>ベクトルでないと正しく動かない関数 (<code>mean</code>, <code>median</code>) もあるので注意</li>

</ul></li>

</ul>
</section>
<section id="slide-org184b8cb">
<h3 id="org184b8cb">列ごとの集約</h3>
<ul>
<li><p>
関数 <code>dplyr::summarise()</code> : 列ごとに計算する
</p>
<div class="org-src-container">

<pre class="src src-R">summarise(.data, ..., .by = <span style="color: #00aa80;">NULL</span>, .groups = <span style="color: #00aa80;">NULL</span>)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ...: &#27714;&#12417;&#12383;&#12356;&#32113;&#35336;&#37327;&#12434;&#35336;&#31639;&#12377;&#12427;&#12383;&#12417;&#12398;&#20966;&#29702;&#12434;&#35352;&#36848;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .by: &#12464;&#12523;&#12540;&#12503;&#21270;&#12434;&#25351;&#23450;(&#23455;&#39443;&#30340;&#12394;&#23455;&#35013;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .groups: &#12464;&#12523;&#12540;&#12503;&#21270;&#12398;&#32080;&#26524;&#12434;&#25351;&#23450;(&#23455;&#39443;&#30340;&#12394;&#23455;&#35013;)</span>
</pre>
</div></li>
<li><p>
<span style="color:green;">集計値の算出</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32244;&#32722;&#21839;&#38988;&#12398;&#12487;&#12540;&#12479;&#12434;&#29992;&#12356;&#12383;&#20363;</span>
jp_data |&gt; summarise(&#24179;&#22343;&#22833;&#26989;&#29575; = mean(&#22833;&#26989;), &#20214;&#25968; = n()) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#22833;&#26989;&#12398;&#21015;&#12398;&#24179;&#22343;</span>
jp_data |&gt; summarise(across(&#23130;&#23035;:&#22833;&#26989;, median)) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#23130;&#23035;&#12363;&#12425;&#22833;&#26989;&#12398;&#21015;&#12398;&#20013;&#22830;&#20516;</span>
jp_data |&gt; summarise(across(!&#30476;&#21517;, max)) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#30476;&#21517;&#12398;&#21015;&#20197;&#22806;&#12398;&#26368;&#22823;&#20516;</span>
jp_data |&gt; summarise(across(where(is.double), min)) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#25968;&#20516;&#21015;&#12398;&#26368;&#23567;&#20516;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-orge9788d8">
<h3 id="orge9788d8">グループごとの操作</h3>
<ul>
<li><p>
関数 <code>dplyr::group_by()</code> : グループ化を行う
</p>
<div class="org-src-container">

<pre class="src src-R">group_by(.data, ..., .add = <span style="color: #00aa80;">FALSE</span>, .drop = group_by_drop_default(.data))
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ...: &#12464;&#12523;&#12540;&#12503;&#21270;&#12434;&#34892;&#12358;&#38917;&#30446;&#12434;&#21547;&#12416;&#21015;&#12420;&#26465;&#20214;&#12434;&#35352;&#36848;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .add: &#12464;&#12523;&#12540;&#12503;&#21270;&#12398;&#19978;&#26360;&#12365;&#12434;&#21046;&#24481;(&#26082;&#23450;&#20516;FALSE&#12399;&#19978;&#26360;&#12365;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> .drop: &#12464;&#12523;&#12540;&#12503;&#21270;&#12395;&#38306;&#19982;&#12375;&#12394;&#12356;&#22240;&#23376;&#12398;&#25201;&#12356;&#26041;</span>
</pre>
</div></li>
<li><p>
<span style="color:green;">グループごとに集計</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#32244;&#32722;&#21839;&#38988;&#12398;&#12487;&#12540;&#12479;&#12434;&#29992;&#12356;&#12383;&#20363;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#22320;&#26041;&#12372;&#12392;&#12395;&#20154;&#21475;&#12363;&#12425;&#38754;&#31309;&#12398;&#21015;&#12398;&#21512;&#35336;&#12434;&#35336;&#31639;&#12377;&#12427;</span>
jp_data |&gt;
  mutate(&#22320;&#26041; = as_factor(jp_area[[<span style="color: #d08928;">"&#22320;&#26041;"</span>]])) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#22320;&#26041;&#12398;&#24773;&#22577;&#12434;&#20184;&#21152;</span>
  group_by(&#22320;&#26041;) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#22320;&#26041;&#12372;&#12392;&#12395;&#12464;&#12523;&#12540;&#12503;&#21270;</span>
  summarize((across(&#20154;&#21475;:&#38754;&#31309;, sum))) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12464;&#12523;&#12540;&#12503;&#12372;&#12392;&#12395;&#38598;&#35336;</span>
</pre>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-org23f7801" data-background="#fef4f4">
<h2 id="org23f7801">実習</h2>
</section>
<section id="slide-org86f3279" data-background="#fef4f4">
<h3 id="org86f3279">練習問題</h3>
<ul>
<li>サンプルデータ (<code>jpdata</code>) の整理をしてみよう．
<ul>
<li>県別の人口密度を求めよ．</li>
<li>地方別の人口密度を求めよ．
<ul>
<li>県ごとに人口が異なるので単純に人口密度を平均してはいけない．</li>

</ul></li>
<li>地方別の1000人当たりの婚姻・離婚数を概算せよ．
<ul>
<li>データの記述では「人口1000人当たり」とあるが，
この「人口」とは若年層は婚姻不可として除いた
「婚姻可能な人口1000人当たり」
と考えて計算しなさい．</li>

</ul></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org781d20c">
<h2 id="org781d20c">次回の予定</h2>
<ul>
<li>可視化の重要性</li>
<li>基本的な描画</li>
<li>分布の視覚化</li>
<li>比率の視覚化</li>
<li>多次元データの視覚化</li>

</ul>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/menu/menu.js"></script>
<script src="./reveal.js/plugin/spotlight/spotlight.js"></script>
<script src="./reveal.js/plugin/chalkboard/plugin.js"></script>
<script src="./reveal.js/dist/theme/hidelinks.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
showNotes: window.location.search.match( /print-pdf/gi ) ? 'separate-page' : false,
spotlight: { size: 80, initialPresentationMode: false, }, keyboard: { 81: function() { RevealSpotlight.toggleSpotlight()}, 87: function() { RevealSpotlight.togglePresentationMode();}, },

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealMenu, RevealSpotlight, RevealChalkboard ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>

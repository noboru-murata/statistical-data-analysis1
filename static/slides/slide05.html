<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>データの可視化</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/mycourse.css"/>
<link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">データの可視化</h1>
</div>
<div class="talk-subtitle">
    <p>様々なグラフの描画</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>

<section>
<section id="slide-org2c28795">
<h2 id="org2c28795">講義の内容</h2>
<ul>
<li>可視化の重要性</li>
<li>基本的な描画</li>
<li>分布の視覚化</li>
<li>比率の視覚化</li>
<li>多次元データの視覚化</li>

</ul>
<div class="slide-footer"><br></div>

</section>
</section>
<section>
<section id="slide-org3a24ddf">
<h2 id="org3a24ddf">可視化の重要性</h2>
<div class="outline-text-2" id="text-org3a24ddf">
</div>
</section>
<section id="slide-org61c06e4">
<h3 id="org61c06e4">可視化のための機能</h3>
<ul>
<li>データの特徴や傾向を把握するために効果的</li>
<li>Rはきわめて多彩な作図機能を持つ</li>
<li><code>package::graphics</code> 
に含まれる代表的な描画関数を取り上げて解説する
<ul>
<li>描画関連の関数は色，
線の種類や太さ，
あるいは図中の文字の大きさなどを指定することができる</li>
<li>用意されている多彩なオプションは説明しきれないため，
必要に応じて
関数 <code>help()</code> (ヘルプ)と
関数 <code>example()</code> (例題)
を参照のこと</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org03ece34">
<h3 id="org03ece34">図の保存</h3>
<ul>
<li>RStudioの機能を使う場合 :
<ol>
<li>右下ペインの&ldquo;Plots&rdquo;タブの&ldquo;Export&rdquo;をクリック</li>
<li>形式を指定する 
<i><span style="color:orange;">クリップボードにコピーもできる</span></i></li>
<li>サイズを指定して保存</li>

</ol></li>
<li><p>
コンソール / R Scriptで実行する場合 :
</p>
<ul>
<li><code>help("pdf")</code> : PDFファイルに保存</li>
<li><code>help("png")</code> : PNGファイルに保存</li>
<li><code>help("dev.copy")</code> : &ldquo;graphic device&rdquo; 間でコピー</li>

</ul>
<p>
などを参照
</p></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgee1e5d1">
<h3 id="orgee1e5d1">サンプルデータの説明</h3>
<ul>
<li><code>jpdata</code>
<ul>
<li><a href="https://www.e-stat.go.jp">https://www.e-stat.go.jp</a> (統計局)
<ul>
<li>地域から探す / 全県を選択 / 項目を選択してダウンロード</li>
<li>日本語が扱えることを想定して日本語</li>
<li>英語のために -en を用意</li>

</ul></li>
<li>データファイル (文字コード : utf8)
<ul>
<li>jpdata1.csv : 県別の対象データ</li>
<li>jpdata2.csv : 対象データの内容</li>
<li>jpdata3.csv : 県別と地域の対応関係</li>

</ul></li>
<li><p>
作業ディレクトリのdata内に置いて読み込む場合
</p>
<div class="org-src-container">

<pre><code class="R" >JP.data &lt;- read.csv(file="data/jpdata1.csv", fileEncoding="utf8", row.names=1)
JP.item &lt;- read.csv(file="data/jpdata2.csv", fileEncoding="utf8")
JP.area &lt;- read.csv(file="data/jpdata3.csv", fileEncoding="utf8")
</code></pre>
</div>
<ul>
<li>変数名は自由に付けてよい</li>

</ul></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><code>tokyo_weather</code>
<ul>
<li><a href="https://www.jma.go.jp">https://www.jma.go.jp</a> (気象庁)
<ul>
<li>各種データ・資料 / 過去の地点気象データ・ダウンロード</li>
<li>地点 / 項目 / 期間を選択してダウンロード</li>

</ul></li>
<li><p>
データ項目
</p>
<blockquote>
<p>
平均気温(℃),降水量の合計(mm),合計全天日射量(MJ/㎡),降雪量合計(cm),最多風向(16方位),平均風速(m/s),平均現地気圧(hPa),平均湿度(％),平均雲量(10分比),天気概況(昼：06時〜18時),天気概況(夜：18時〜翌日06時)
</p>
</blockquote></li>
<li><p>
作業ディレクトリのdata内に置いて読み込む場合
</p>
<div class="org-src-container">

<pre><code class="R" >TW.data &lt;- read.csv(file="data/tokyo_weather.csv")
</code></pre>
</div></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><code>tokyo_covid19_2021</code>
<ul>
<li><a href="https://stopcovid19.metro.tokyo.lg.jp">https://stopcovid19.metro.tokyo.lg.jp</a> (東京都)</li>
<li><p>
データ項目
</p>
<blockquote>
<p>
陽性者数, 総検査実施件数, 発熱等相談件数
</p>
</blockquote></li>
<li><p>
作業ディレクトリのdata内に置いて読み込む場合
</p>
<div class="org-src-container">

<pre><code class="R" >TC.data &lt;- read.csv(file="data/tokyo_covid19_2021.csv", fileEncoding="utf8")
</code></pre>
</div></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-org2beab77">
<h2 id="org2beab77">基本的な描画</h2>
<div class="outline-text-2" id="text-org2beab77">
</div>
</section>
<section id="slide-org5f284b2">
<h3 id="org5f284b2">関数 <code>plot()</code></h3>
<ul>
<li><p>
ベクトルデータの描画を行う関数
</p>
<div class="org-src-container">

<pre><code class="R" >plot(x, y = NULL, type = "p", xlim = NULL, ylim = NULL,
     main = NULL, xlab = NULL, ylab = NULL, ...) 
## x, y: ベクトル． y は省略可能．
## type: 描画タイプ．既定値は "p" (点)．"l" (折れ線)などが指定可
## xlim/ylim: x/y 軸の範囲．既定値は自動的に決定
## main: 図のタイトル．既定値は空白
## xlab: x 軸のラベル名．既定値は Index
## ylab: y 軸のラベル名．既定値は x のオブジェクト名
## ...: その他のオプション
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orga8318ed">
<h3 id="orga8318ed">関数 <code>plot()</code> のオプション</h3>
<ul>
<li>よく利用される <code>...</code> の部分
<ul>
<li><code>col</code> : 色の指定．
<code>"red"</code> や <code>"blue"</code> など．
指定可能な色は関数 <code>colors()</code> を参照</li>
<li><code>pch</code> : 点の形．
詳細は <code>help("points")</code> を参照</li>
<li><code>lty</code> : 線のタイプ．
実線・破線など．タイプ名もしくは数字で指定．
詳細は <code>help("par")</code> を参照</li>
<li><code>lwd</code> : 線の太さ．数字で指定</li>
<li><code>cex</code> : 文字の大きさ．
既定値の何倍にするかを指定</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org963d220">
<h3 id="org963d220">ベクトルの描画の例</h3>
<ul>
<li>1変数の場合 <code>plot(x)</code></li>
<li>2変数の場合 <code>plot(x,y)</code></li>
<li>基本的なオプションの指定例</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
1変数の場合 <code>plot(x)</code>
</p>
<div class="org-src-container">

<pre><code class="R" >x &lt;- pi/6*(0:12) # 30度(pi/6)おきに1周期分 (0-2*pi)
plot(sin(x)) # x軸はベクトルの要素番号(Index)，y軸はsin(x)の値を描画
</code></pre>
</div></li>

</ul>


<div id="org1cb6e2d" class="figure">
<p><img src="figs/graph-plot1.png" alt="graph-plot1.png" height="100%" />
</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
2変数の場合 <code>plot(x,y)</code>
</p>
<div class="org-src-container">

<pre><code class="R" >x &lt;- pi/6*(0:12)
plot(x, sin(x)) # x の値に対する y=sin(x) の値を対応づけて描画
</code></pre>
</div></li>

</ul>


<div id="org865bca6" class="figure">
<p><img src="figs/graph-plot2.png" alt="graph-plot2.png" height="100%" />
</p>
</div>


<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
オプションの例
</p>
<div class="org-src-container">

<pre><code class="R" >x &lt;- pi/6*(0:12)
plot(x,sin(x),type="l",lwd=3,col="blue",ylab="y=sin(x)") 
</code></pre>
</div></li>

</ul>


<div id="orgcb9b715" class="figure">
<p><img src="figs/graph-plot3.png" alt="graph-plot3.png" height="100%" />
</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org664787c">
<h3 id="org664787c">重ね描き</h3>
<ul>
<li><p>
別のベクトルを点として重ね描きする場合
</p>
<div class="org-src-container">

<pre><code class="R" >points(x, y = NULL, ...) # ... は関数 plot() と同様なオプションが指定可能
</code></pre>
</div></li>
<li><p>
別のベクトルを線として重ね描きする場合
</p>
<div class="org-src-container">

<pre><code class="R" >lines(x, y = NULL, ...) # ... は関数 plot() と同様なオプションが指定可能
</code></pre>
</div></li>
<li><p>
文字を重ね描きする場合
</p>
<div class="org-src-container">

<pre><code class="R" >text(x, y = NULL, labels, ...) # labelsに文字列を指定
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org1b979fd">
<h3 id="org1b979fd">重ね描きの例</h3>
<ul>
<li><p>
ベクトルデータの重ね描き
</p>
<div class="org-src-container">

<pre><code class="R" >x &lt;- seq(0, 4*pi, by=0.5)
y &lt;- sin(x)
z &lt;- cos(x)
plot(x, y, type="b", pch="x", ylim=c(-2,2), col="red") # "b"="p+l"
points(x, z, col="blue", pch="C") # 点を追加. pchは文字も指定できる
lines(x, z, col="cyan", lwd=3) # 折れ線を追加
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="orgafbbf6d" class="figure">
<p><img src="figs/graph-plot4.png" alt="graph-plot4.png" height="100%" />
</p>
<p><span class="figure-number">Figure 1: </span>ベクトルデータの重ね描き</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org94c66f4">
<h3 id="org94c66f4">関数 <code>curve()</code></h3>
<ul>
<li><p>
1変数関数の描画を行う関数
</p>
<div class="org-src-container">

<pre><code class="R" >curve(expr, from = NULL, to = NULL, add = FALSE,
      type = "l", xname = "x", xlab = xname, ylab = NULL, ...)
## expr: 1変数関数 (関数名)
## from: x 軸の左端
## to: x 軸の右端
## add: TRUE で重ね描きする
## xname: x 軸の変数名
</code></pre>
</div></li>
<li><p>
関数 <code>plot()</code> にも同様の機能がある
</p>
<div class="org-src-container">

<pre><code class="R" >plot(x, y = 0, to = 1, ...) # ... は"ベクトルの描画"と同様に指定が可能
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgf38b416">
<h3 id="orgf38b416">関数の描画の例</h3>
<ul>
<li><p>
関数の描画
</p>
<div class="org-src-container">

<pre><code class="R" >curve(sin, from=0, to=4*pi, 
      col="blue", lwd=2, # グラフの線の色と太さ
      xlab="time", ylab="sin/cos") # x/y軸のラベルの文字列を指定
curve(cos, # 上書きする場合は範囲の指定は不要
      add=TRUE, # グラフを上書き
      col="red", lwd=2)
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="orgb7883c7" class="figure">
<p><img src="figs/graph-plot5.png" alt="graph-plot5.png" height="100%" /> 
</p>
<p><span class="figure-number">Figure 2: </span>関数の描画</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
関数とベクトルデータの重ね描き
</p>
<div class="org-src-container">

<pre><code class="R" >x &lt;- seq(0, 4*pi, by=0.25)
y &lt;- sin(x) + rep(c(-0.2, 0.1), len=length(x))
plot(x, y, type="p", pch="x", ylim=c(-2,2), col="red") 
lines(x, y, col="blue", lwd=2) # 折れ線を追加
curve(sin, add=TRUE, col="orange", lwd=3)
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="orgb0030b4" class="figure">
<p><img src="figs/graph-plot6.png" alt="graph-plot6.png" height="100%" />
</p>
<p><span class="figure-number">Figure 3: </span>関数とベクトルデータの重ね描き</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org4c087a6">
<h3 id="org4c087a6">散布図</h3>
<ul>
<li>2種類のデータ \(x_1,\dots,x_n\)
および \(y_1,\dots,y_n\) が与えられたとき，
同じ index を持つ点 \((x_1,y_1),\dotsc,(x_n,y_n)\) を
平面上に描画した図</li>
<li>データの性質を捉えるための基本的な描画の方法</li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org9584615">
<h3 id="org9584615">関数 <code>plot()</code></h3>
<ul>
<li><p>
ベクトルデータの散布図を作成する (既出の機能)
</p>
<div class="org-src-container">

<pre><code class="R" >plot(x, y = NULL, ...) #... は"ベクトルの描画"と同様に指定が可能
## x: 1種類目のデータ c(x1,x2,...)
## y: 2種類目のデータ c(y1,y2,...) (x と同じ長さ)
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org137cd61">
<h3 id="org137cd61">関数 <code>plot()</code></h3>
<p>
データフレーム <code>x</code> の変数A，Bの散布図を作成する
</p>
<ul>
<li><p>
基本書式
</p>
<div class="org-src-container">

<pre><code class="R" >plot(B ~ A, data = x, ...) # "Y軸 ~ X軸" と指定
## x: データフレーム
## A,B: 変数名 (データフレームの列名を利用可能) 
##      "B ~ A" は formula と呼ばれる
</code></pre>
</div>
<ul>
<li>formula の書き方は <code>help("formula")</code> を参照</li>
<li>データフレーム <code>x</code> に対して
<code>plot(x)</code> を実行すると，
すべての変数のペアに対する散布図が
作成される(散布図行列・対散布図; <code>pairs()</code> 後述)</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org5446725">
<h3 id="org5446725">散布図の例</h3>
<ul>
<li><p>
データフレームを用いた散布図
</p>
<div class="org-src-container">

<pre><code class="R" >plot(Ozone ~ Wind, data=airquality, # xy軸名は列の名前が使われる
     pch="*", # 点の形を文字で指定することもできる
     col="red", 
     cex=2) # cexは点の大きさの倍率を指定する
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org9c4b447" class="figure">
<p><img src="figs/graph-plot7.png" alt="graph-plot7.png" height="100%" />
</p>
<p><span class="figure-number">Figure 4: </span>データフレームを用いた散布図</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org89c7de8">
<h3 id="org89c7de8">日本語に関する注意</h3>
<ul>
<li>日本語を含む図で文字化けが起こった場合 <br />
(主にmacOS)
<ul>
<li><p>
関数 <code>par</code> の <code>family</code> オプションでフォントを指定 <br />
ヒラギノ角ゴシックW4を指定する場合
</p>
<div class="org-src-container">

<pre><code class="R" >par(family="HiraginoSans-W4") # 数字を変えると太さが変わる
</code></pre>
</div></li>
<li>以下のサイトなども参考になる <br />
<a href="https://oku.edu.mie-u.ac.jp/~okumura/stat/font.html">https://oku.edu.mie-u.ac.jp/~okumura/stat/font.html</a></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgb5c9013" data-background="#fef4f4">
<h2 id="orgb5c9013">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org1ea7b56" data-background="#fef4f4">
<h3 id="org1ea7b56">練習問題</h3>
<ul>
<li><code>jpdata1/3.csv</code> (前回配布のデータ)を用いて以下の問に答えよ．
<ul>
<li>婚姻・離婚率の散布図を描け．</li>
<li>地方別に異なる点の形状を用いた散布図を描け．</li>
<li>それ以外にも様々な散布図を描画してみよう．</li>
<li><p>
(参考) 読み込み方
</p>
<div class="org-src-container">

<pre><code class="R" >## CSVファイルは作業ディレクトリの下の data サブディレクトリにあるとする
JP.data &lt;- read.csv(file="data/jpdata1.csv", fileEncoding="utf8", row.names=1)
JP.area &lt;- read.csv(file="data/jpdata3.csv", fileEncoding="utf8")
</code></pre>
</div></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
</section>
<section>
<section id="slide-org52643a8">
<h2 id="org52643a8">分布の視覚化</h2>
<div class="outline-text-2" id="text-org52643a8">
</div>
</section>
<section id="slide-orgc948c8d">
<h3 id="orgc948c8d">ヒストグラム</h3>
<ul>
<li>データの値の範囲をいくつかの区間に分割し，
各区間に含まれるデータ数を棒グラフにしたもの</li>
<li>各棒グラフの矩形
<ul>
<li>横幅が区間に対応</li>
<li>面積が区間に含まれるデータの個数に比例</li>

</ul></li>
<li>データの分布の仕方を可視化するのに有効
<ul>
<li>どのあたりに値が集中しているか</li>
<li>どの程度値にばらつきがあるか</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgb228056">
<h3 id="orgb228056">関数 <code>hist()</code></h3>
<ul>
<li><p>
ヒストグラムを描画する関数
</p>
<div class="org-src-container">

<pre><code class="R" >hist(x, breaks = "Sturges", freq, ...) # ... は関数 plot() と同様に指定可能
## x: ベクトル
## breaks: 区間の分割の仕方を指定．既定値はSturgesの公式．      
##         数字を指定するとデータ範囲をその数字に近い個数に等分割する．
##         詳細はヘルプを参照
## freq: TRUE (既定値)を指定すると縦軸はデータ数
##       FALSE を指定すると縦軸はデータ数/全データ数
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgdc61ac2">
<h3 id="orgdc61ac2">ヒストグラムの例</h3>
<ul>
<li><p>
関数 <code>hist()</code> によるヒストグラムの作図
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 東京都の気温のヒストグラムを作成する
TW.data &lt;- read.csv("data/tokyo_weather.csv") # 東京都の気象データの読み込み
hist(TW.data$temp, 
     xlab="気温(℃)", ylab="頻度",
     breaks=25, # ビンの数を約25に設定
     labels=TRUE, # 各ビンの度数を表示
     col="lightpink", main="気温のヒストグラム")
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org1ff2dd0" class="figure">
<p><img src="figs/graph-hist1.png" alt="graph-hist1.png" height="100%" />
</p>
<p><span class="figure-number">Figure 5: </span>ヒストグラム</p>
</div>


<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
密度での表示
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
hist(TW.data$wind, freq=FALSE, # 全体に対する割合で表示
     xlab="風速(m/s)", ylab="密度",
     breaks=25, 
     col="lightblue", border="blue", # 長方形の境界の色
     main="風速の密度") 
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>


<div id="org577b7d9" class="figure">
<p><img src="figs/graph-hist2.png" alt="graph-hist2.png" height="100%" />
</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org721c194">
<h3 id="org721c194">箱ひげ図</h3>
<ul>
<li>データの中心，散らばり具合および外れ値を考察するための図 
(ヒストグラムの簡易版)</li>
<li>複数のデータの分布の比較の際に有効
<ul>
<li>太線で表示された中央値(第2四分位点)</li>
<li>第1四分位点を下端・第3四分位点を上端とする長方形(箱)</li>
<li>第1四分位点・第3四分位点からそれぞれ箱の長さの1.5倍以内にあるデータのうちの
最小の値・最大の値を下端・上端とする直線(ひげ)</li>

</ul></li>
<li>ひげの外側のデータは点で表示される</li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgcb58b38">
<h3 id="orgcb58b38">関数 <code>boxplot()</code></h3>
<ul>
<li><p>
箱ひげ図を描画する関数
</p>
<div class="org-src-container">

<pre><code class="R" >boxplot(x, ...) # ... は関数 plot() と同様に指定可能
## x: ベクトルまたはデータフレーム
##    ベクトルに対しては単一の箱ひげ図
##    データフレーム対しては列ごとの箱ひげ図
</code></pre>
</div></li>
<li><p>
質的変数ごとに分類して描画する場合 
</p>
<div class="org-src-container">

<pre><code class="R" >boxplot(B ~ A, data = x, ...) 
## x: データフレーム
## A: x の変数 (質的変数; 性別・植物の種類など)
## B: x の変数
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org2ebd277">
<h3 id="org2ebd277">箱ひげ図の例</h3>
<ul>
<li><p>
関数 <code>boxplot()</code> による箱ひげ図の作図
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 気温, 降雨, 日射, 降雪, 風速の箱ひげ図を作成する
boxplot(subset(TW.data, select=c(temp:snow,wind)), # 数値データの一部を抽出
	names=c("気温","降雨","日射","降雪","風速")) # 各箱ひげ図の名前を指定
## names を指定しなければ列名が使われる 
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="orge011c09" class="figure">
<p><img src="figs/graph-boxplot1.png" alt="graph-boxplot1.png" height="100%" />
</p>
<p><span class="figure-number">Figure 6: </span>箱ひげ図</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
条件ごとの箱ひげ図の作図
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 月ごとの気温の分布を箱ひげ図によって可視化する
boxplot(temp ~ month, data=TW.data,
	col="orange",
	xlab="月",ylab="気温",main="月ごとの気温")
## 図を回転する場合は horizontal を指定する
## boxplot(気温 ~ 月, data=myData,
##         col="purple", main="月ごとの気温", horizontal=TRUE)
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org8a64c06" class="figure">
<p><img src="figs/graph-boxplot2.png" alt="graph-boxplot2.png" height="100%" />
</p>
<p><span class="figure-number">Figure 7: </span>条件ごとの箱ひげ図</p>
</div>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgcc19e84">
<h2 id="orgcc19e84">比率の視覚化</h2>
<div class="outline-text-2" id="text-orgcc19e84">
</div>
</section>
<section id="slide-org7fba38e">
<h3 id="org7fba38e">関数 <code>barplot()</code></h3>
<ul>
<li><p>
棒グラフを作成する関数
</p>
<div class="org-src-container">

<pre><code class="R" >barplot(x, width = 1, space = NULL, beside = FALSE,
        legend.text = NULL, args.legend = NULL, 
        ...) # ... は関数 plot() と同様に指定可能
## x: ベクトルまたは行列 (データフレームは不可)
## width: 棒の幅
## space: 棒グラフ間・変数間のスペース
## legend.text: 凡例
## beside: 複数の変数を縦に並べるか・横に並べるか
## args.legend: 関数 legend() に渡す引数
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgc507b59">
<h3 id="orgc507b59">棒グラフの例</h3>
<ul>
<li><p>
関数 <code>barplot()</code> による棒グラフの作図
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 月ごとに各変数の平均を計算
(foo &lt;- aggregate(. ~ month, FUN=mean,
		  data=subset(TW.data, select=c(month,temp:snow,wind))))
## 月ごとの気温の平均値の棒グラフを作成する
barplot(foo$temp, # 棒の高さのベクトル
	col="slateblue", # 棒の色の指定
	names.arg=foo$month, # x軸のラベル
	xlab="月",main="平均気温") # タイトル 
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org27e0653" class="figure">
<p><img src="figs/graph-barplot1.png" alt="graph-barplot1.png" height="100%" />
</p>
<p><span class="figure-number">Figure 8: </span>棒グラフ</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
複数の棒グラフ
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 気温, 降雨, 日射, 降雪, 風速の月ごとの棒グラフを作成する
barplot(as.matrix(foo[ ,-1]), # 第1引数のデータフレームは行列にする
	col=rainbow(12)[c(8:1,12:9)], # 12色に色分け．季節に合うように色を並べ変えている
	beside=TRUE, # 各列ごとの棒グラフを横に並べる
	space=c(1.5, 3), # 棒グラフ間・変数間のスペースを指定
	names.arg=c("気温","降雨","日射","降雪","風速"), # 各列の名前を指定．指定しなければ列名が使われる
	legend.text=paste0(foo$month,"月"), # 凡例の指定
	args.legend=list(ncol=2)) # 凡例を2列にして表示
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>


<div id="org822a8bc" class="figure">
<p><img src="figs/graph-barplot2.png" alt="graph-barplot2.png" height="100%" />
</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org5ec2ba9">
<h3 id="org5ec2ba9">関数 <code>pie()</code></h3>
<ul>
<li><p>
円グラフを作成する関数
</p>
<div class="org-src-container">

<pre><code class="R" >pie(x, clockwise = FALSE, ...) # ... は関数 plot() と同様に指定可能
## x: ベクトル
## clockwise: 時計回りに書くか否か
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-orgc3d51b3">
<h3 id="orgc3d51b3">円グラフの例</h3>
<ul>
<li><p>
関数 <code>pie()</code> による円グラフの作図
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## ヒストグラムの機能を用いてデータの集計を行う
foo &lt;- hist(TW.data$solar, breaks=5, plot=FALSE) # 5つ程度に分類を指定．実際には6つに分類
bar &lt;- foo$count # 各ビン内のデータ数
baz &lt;- foo$breaks # ビンの境界
names(bar) &lt;- paste(baz[-length(baz)],baz[-1],sep="-") # ビンの範囲の文字列を作成
## 6つに分類した日射量ごとの日数の割合を示す円グラフを作成する
pie(bar, clockwise=TRUE, main="日射量別の日数の割合",
    col=heat.colors(length(bar),rev=TRUE)) # 日射量が高いほど赤を濃く指定
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org40ce35f" class="figure">
<p><img src="figs/graph-pie1.png" alt="graph-pie1.png" height="100%" />
</p>
<p><span class="figure-number">Figure 9: </span>円グラフ</p>
</div>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgd0a87ba" data-background="#fef4f4">
<h2 id="orgd0a87ba">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orga0b0913" data-background="#fef4f4">
<h3 id="orga0b0913">練習問題</h3>
<ul>
<li><code>tokyo_covid19_2021.csv</code> (東京都の新型コロナウイルス感染動向データ)
を用いて以下の問に答えよ．
<ul>
<li>陽性者数の推移の折線グラフを描け．</li>
<li>総検査実施件数の推移の棒グラフを描け．</li>
<li>曜日ごとの総検査実施件数の箱ひげ図を描け．</li>
<li><p>
(参考) 読み込み方
</p>
<div class="org-src-container">

<pre><code class="R" >## CSVファイルは作業ディレクトリの下の data サブディレクトリにあるとする
TC.data &lt;- read.csv(file="data/tokyo_covid19_2021.csv",fileEncoding="utf8")
</code></pre>
</div></li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
</section>
<section>
<section id="slide-org9d74c1f">
<h2 id="org9d74c1f">多次元データの視覚化</h2>
<div class="outline-text-2" id="text-org9d74c1f">
</div>
</section>
<section id="slide-org590c8c9">
<h3 id="org590c8c9">関数 <code>pairs()</code></h3>
<ul>
<li><p>
対散布図(散布図行列)を作成する関数
</p>
<div class="org-src-container">

<pre><code class="R" >pairs(x, ...) # 関数 plot() でも良い
## x: データフレーム 
</code></pre>
</div>
<ul>
<li>すべての列のペアに対する散布図を行列状に配置</li>

</ul></li>
<li><p>
変数 <code>A1</code>, \(\dots\), <code>Ak</code> (列名)のみ考える場合
</p>
<div class="org-src-container">

<pre><code class="R" >pairs(~ A1 + ... + Ak, data = x, ...) # 関数 plot() でも良い
## x: データフレーム
## A1,...,Ak: データフレームの列名
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org2b83274">
<h3 id="org2b83274">散布図行列の例</h3>
<ul>
<li><p>
関数 <code>pairs()</code> による散布図の作図
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 気温, 日射, 風速に関する散布図を作成する
pairs(~ temp + solar + wind, data=TW.data,
      labels=c("気温","日射","風速"), # 指定しなければ列名が使われる
      col=rainbow(12)[TW.data$month]) # 月毎に異なる色で表示
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org4d0caaa" class="figure">
<p><img src="figs/graph-pairs1.png" alt="graph-pairs1.png" height="100%" />
</p>
<p><span class="figure-number">Figure 10: </span>散布図行列</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org645fbcf">
<h3 id="org645fbcf">関数 <code>persp()</code></h3>
<ul>
<li><p>
3次元のグラフを2次元に射影した俯瞰図を描く関数
</p>
<div class="org-src-container">

<pre><code class="R" >persp(x, y, z, theta = 0, phi = 15, expand = 1, ...) # ... は関数 plot() と同様に指定可能
## x,y,z: x,y,z 座標
##        z は点(x[i],y[j])に対応する値を(i,j) 成分とする行列で与える必要がある
## theta,phi: 俯瞰の方向を指定する極座標
## expand: z軸の拡大度
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org287c9f9">
<h3 id="org287c9f9">3次元俯瞰図の例</h3>
<ul>
<li><p>
関数 <code>persp()</code> による2変数関数の俯瞰図
</p>
<div class="org-src-container">

<pre><code class="R" >f &lt;- function(x,y) x^2 - y^2
x &lt;- seq(-3, 3, length=51) # x座標の定義域の分割
y &lt;- seq(-3, 3, length=51) # y座標の定義域の分割
z &lt;- outer(x, y, f) # z座標の計算
## 基本的な俯瞰図
## persp(x, y, z, col="lightblue")
## 俯瞰する向きを指定
persp(x, y, z, theta=30, phi=30, expand=0.5, # 俯瞰する視線の設定
      col="royalblue", main=expression(z==x^2-y^2))
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="orgf8276c4" class="figure">
<p><img src="figs/graph-plot3d1.png" alt="graph-plot3d1.png" height="100%" />
</p>
<p><span class="figure-number">Figure 11: </span>俯瞰図</p>
</div>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org8023600">
<h3 id="org8023600">3次元グラフのためのパッケージ</h3>
<ul>
<li><p>
以下は <code>scatterplot3d()</code> の例
</p>
<div class="org-src-container">

<pre><code class="R" >library(scatterplot3d) # パッケージの読み込み
scatterplot3d(x, color, angle = 40, ...) # ... は関数 plot() とは若干異なる
## x: x,y,z座標を指定するデータフレーム
##    関数 persp() のようにx,y,zを個別に指定することも可能
## color: 色を指定(colではないので注意). 既定値は黒
## angle: x軸とy軸の間の角度
</code></pre>
</div>
<ul>
<li>詳細は <code>example("scatterplot3d")</code> を参照</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org4ac4e64">
<h3 id="org4ac4e64">3次元散布図の例</h3>
<ul>
<li><p>
関数 <code>scatterplot3d()</code> による3次元散布図
</p>
<div class="org-src-container">

<pre><code class="R" >## install.packages("scatterplot3d") # 初めて使う時に必要
library(scatterplot3d) # パッケージのロード
if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 風速, 日射, 気温の3次元散布図を作成する
scatterplot3d(subset(TW.data, select=c(wind, solar, temp)),
	      xlab="風速",ylab="日射",zlab="気温", # 指定しなければ列名が使われる
	      pch=4, color="orchid")
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org143f75b" class="figure">
<p><img src="figs/graph-plot3d2.png" alt="graph-plot3d2.png" height="100%" />
</p>
<p><span class="figure-number">Figure 12: </span>3次元散布図</p>
</div>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgfe0e359">
<h2 id="orgfe0e359">凡例の追加</h2>
<div class="outline-text-2" id="text-orgfe0e359">
</div>
</section>
<section id="slide-orgd30c48e">
<h3 id="orgd30c48e">関数 <code>legend()</code></h3>
<ul>
<li><p>
グラフに凡例を追加する関数
</p>
<div class="org-src-container">

<pre><code class="R" >legend(x, y = NULL, legend, ...) # ...はその他のオプション
## x,y: 凡例の位置を指定 (座標やキーワードで指定が可能)
## legend: 凡例の文字列ベクトル
</code></pre>
</div>
<ul>
<li>複雑なオプションは <code>help("legend")</code> を参照</li>
<li>数式の表示の詳細は <code>help("plotmath")</code> を参照</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org4281932">
<h3 id="org4281932">凡例の例</h3>
<ul>
<li><p>
凡例の追加
</p>
<div class="org-src-container">

<pre><code class="R" >f &lt;- function(x) exp(-x) * cos(x)
plot(f, 0, 2*pi, col="red", lwd=2, ylab="")
g &lt;- function(x) exp(-x) * sin(x)
curve(g, lty=2, # グラフの線の形式 2は破線
      add=TRUE, col="blue", lwd=2)
legend(4, # 凡例の左上のx座標
       1, # 凡例の左上のy座標
       legend=c(expression(e^{-x}*cos(x)),expression(e^{-x}*sin(x))),
       lty=c(1,2), lwd=2, col=c("red","blue"), # 指定はグラフに準拠
       bty="n", # 凡例の枠線の形式(オプション) "n"は枠線なし
       y.intersp=2) # 行間の指定(オプション)
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>

<div id="org5732ccc" class="figure">
<p><img src="figs/graph-legend.png" alt="graph-legend.png" height="100%" />
</p>
<p><span class="figure-number">Figure 13: </span>凡例の追加</p>
</div>

<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
東京の気象データを用いた例
</p>
<div class="org-src-container">

<pre><code class="R" >if(Sys.info()["sysname"]=="Darwin"){par(family="HiraginoSans-W4")} # 日本語表示  
## 東京の気象データから月ごとの気温,降水量,日射量の平均を計算し描画する
(foo &lt;- aggregate(. ~ month, FUN=mean,
		  data=subset(TW.data, select=c(month,temp,rain,solar))))
plot(foo$temp, type ="b", lwd=3, col="green", ylim=c(0, max(foo$temp)+1),
     xlab="月", ylab="", main="東京の気候データ", axes=FALSE) # 軸は無
axis(1, 1:12, 1:12); axis(2) # x(1),y(2)軸の作成
lines(foo$rain, type="h", lwd=3, col="blue") # 棒グラフ
lines(foo$solar, type="s", lwd=3, lty=2, col="red") # 階段グラフ
abline(0, 0, lwd=2, lty="dotted") #  y=0の線を引く
legend("topleft", inset=0.02, # 左上で全体の2%(0.02)内側に良せる
       legend=c("気温","降水量","日射量"),
       col=c("green","blue","red"), lwd=3, lty=c(1,1,2))
</code></pre>
</div></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section>


<div id="org47167df" class="figure">
<p><img src="figs/graph-font.png" alt="graph-font.png" height="100%" />
</p>
</div>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgc0746d0">
<h2 id="orgc0746d0">補遺</h2>
<div class="outline-text-2" id="text-orgc0746d0">
</div>
</section>
<section id="slide-orgeb694a4">
<h3 id="orgeb694a4">関数 <code>par()</code></h3>
<ul>
<li><p>
グラフィクス環境の設定(複数図の配置, 余白の設定)をする関数
</p>
<div class="org-src-container">

<pre><code class="R" >par(tag = value)
## tag: グラフィックスパラメータ
</code></pre>
</div>
<ul>
<li>描画の際の線の種類や色, 点の形等の既定値を設定することができる</li>
<li>設定可能なグラフィックスパラメータは <code>help("par")</code> を参照</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
<section id="slide-org473b17b">
<h3 id="org473b17b">package::ggplot2</h3>
<ul>
<li>Rのグラフィック機能を拡張するパッケージの1つ</li>
<li>統一的な文法で系統的に美しいグラフを描くことを目指して開発</li>
<li>詳細については <a href="https://docs.ggplot2.org/">https://docs.ggplot2.org/</a> を参照</li>

</ul>
<div class="slide-footer"><br></div>


</section>
</section>
<section>
<section id="slide-orgd161d6a" data-background="#fef4f4">
<h2 id="orgd161d6a">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org7137ecb" data-background="#fef4f4">
<h3 id="org7137ecb">練習問題</h3>
<ul>
<li><p>
配布したサンプルデータ
</p>
<ul>
<li><code>jpdata1.csv</code></li>
<li><code>tokyo_weather.csv</code></li>
<li><code>covid19_tokyo.csv</code></li>
<li><code>covid19_tokyo_patients.csv</code></li>

</ul>
<p>
を用いて以下の問いに答えよ．
</p>
<ul>
<li>3次元の散布図を作成せよ．</li>
<li>凡例を加えたグラフを作成せよ．</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>

</section>
</section>
<section>
<section id="slide-org38b7b66">
<h2 id="org38b7b66">次回の予定</h2>
<ul>
<li>計算機による数値実験</li>
<li>乱数とは</li>
<li>乱数を用いた数値実験</li>

</ul>
<div class="slide-footer"><br></div>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
spotlight: { size: 90, initialPresentationMode: false }, chalkboard: { toggleChalkboardButton: { left: '80px' }, toggleNotesButton: { left: '130px'}}, keyboard: { 69: function() { RevealChalkboard.toggleNotesCanvas() }, 87: function() { RevealChalkboard.toggleChalkboard() }, 67: function() { RevealChalkboard.clear() }, 82: function() { RevealChalkboard.reset() }, 68: function() { RevealChalkboard.download() }, 88: function() { RevealChalkboard.colorNext() }, 89: function() { RevealChalkboard.colorPrev() }, 84: function() { RevealSpotlight.toggleSpotlight() }, 81: function() { RevealSpotlight.togglePresentationMode()}},

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealHighlight ],

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/menu/menu.js'},
{ src: './reveal.js/plugin/chalkboard/chalkboard.js'},
{ src: './reveal.js/plugin/spotlight/spotlight.js'}]

});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>データの可視化</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/menu.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/font-awesome/css/fontawesome.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/chalkboard/style.css"/>

<link rel="stylesheet" href="./reveal.js/local/mycourse.css"/>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">データの可視化</h1>
</div>
<div class="talk-subtitle">
    <p>第5講 - 様々なグラフの描画</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>
<section>
<section id="slide-orgfc375bb">
<h2 id="orgfc375bb">講義の内容</h2>
<ul>
<li>可視化の重要性</li>
<li>基本的な描画</li>
<li>いろいろな分布の視覚化</li>
<li>比率の視覚化</li>
<li>多次元データの視覚化</li>

</ul>
</section>
</section>
<section>
<section id="slide-org10be0ff">
<h2 id="org10be0ff">可視化の重要性</h2>
<div class="outline-text-2" id="text-org10be0ff">
</div>
</section>
<section id="slide-org43e03c3">
<h3 id="org43e03c3">データの可視化</h3>
<ul>
<li>データ全体の特徴や傾向を把握するための直感的で効果的な方法</li>
<li>R言語には極めて多彩な作図機能が用意されている
<ul>
<li><b>base R</b> : <code>package::graphics</code> (標準で読み込まれる)</li>
<li><b>tidyverse</b> : <code>package::ggplot2</code></li>

</ul></li>
<li>描画関連の関数は色，
線種や線の太さ，
図中の文字の大きさなどを指定することができる</li>

</ul>
</section>
<section id="slide-org854ab8e">
<h3 id="org854ab8e">tidyverse パッケージ</h3>
<ul>
<li>データ操作とグラフィクスの拡張 (再掲)
<ul>
<li><b>tidyverse</b> : Hadley Wickham @posit による拡張パッケージ集
<ul>
<li><a href="https://www.tidyverse.org/packages/">https://www.tidyverse.org/packages/</a></li>
<li><a href="https://tidyverse.tidyverse.org/">https://tidyverse.tidyverse.org/</a></li>

</ul></li>

</ul></li>
<li><p>
パッケージ集の利用には以下が必要 
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#26368;&#21021;&#12395;&#19968;&#24230;&#12384;&#12369;&#20197;&#19979;&#12398;&#12356;&#12378;&#12428;&#12363;&#12434;&#23455;&#34892;&#12375;&#12390;&#12362;&#12367;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;">  - Package &#12479;&#12502;&#12363;&#12425; tidyverse &#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;">  - &#12467;&#12531;&#12477;&#12540;&#12523;&#19978;&#12391;&#27425;&#12398;&#12467;&#12510;&#12531;&#12489;&#12434;&#23455;&#34892; 'install.packages("tidyverse")'</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> tidyverse &#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
<span style="color: #60aa00;">library</span>(tidyverse)
</pre>
</div></li>

</ul>


<ul>
<li>グラフィクスの拡張である <code>ggplot2</code> を利用</li>

</ul>
</section>
<section id="slide-org87f0b85">
<h3 id="org87f0b85">サンプルデータの説明</h3>
<ul>
<li><p>
<code>jpdata[1-3].csv</code> (再掲)
</p>
<blockquote>
<ul>
<li><a href="https://www.e-stat.go.jp">https://www.e-stat.go.jp</a> (統計局)
<ul>
<li>地域から探す / 全県を選択 / 項目を選択してダウンロード</li>
<li>日本語が扱えることを想定して日本語を含んでいる</li>
<li>英語のために -en を用意</li>

</ul></li>
<li>データファイル (文字コード : utf8)
<ul>
<li>jpdata1.csv : 県別の対象データ</li>
<li>jpdata2.csv : 対象データの内容説明</li>
<li>jpdata3.csv : 県と地域の対応関係</li>

</ul></li>

</ul>
</blockquote>
<ul>
<li><p>
作業ディレクトリのdata内に置いて読み込む場合
</p>
<div class="org-src-container">

<pre class="src src-R">jp_data <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata1.csv"</span>)
jp_item <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata2.csv"</span>)
jp_area <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata3.csv"</span>)
</pre>
</div>
<ul>
<li>変数名は自由に付けてよい</li>

</ul></li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
<code>tokyo_weather.csv</code> (<code>tokyo.zip</code> の中)
</p>
<blockquote>
<ul>
<li><a href="https://www.jma.go.jp">https://www.jma.go.jp</a> (気象庁)
<ul>
<li>各種データ・資料 / 過去の地点気象データ・ダウンロード</li>
<li>地点 / 項目 / 期間を選択してダウンロード</li>
<li>ダウンロードしたものを必要事項のみ残して整理</li>

</ul></li>
<li>データ項目
平均気温(℃),降水量の合計(mm),合計全天日射量(MJ/㎡),降雪量合計(cm),最多風向(16方位),平均風速(m/s),平均現地気圧(hPa),平均湿度(％),平均雲量(10分比),天気概況(昼：06時〜18時),天気概況(夜：18時〜翌日06時)</li>

</ul>
</blockquote>
<ul>
<li><p>
作業ディレクトリのdata内に置いて読み込む場合
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/tokyo_weather.csv"</span>)
</pre>
</div></li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
<code>tokyo_covid19_2021.csv</code> (<code>tokyo.zip</code> の中)
</p>
<blockquote>
<ul>
<li><a href="https://stopcovid19.metro.tokyo.lg.jp">https://stopcovid19.metro.tokyo.lg.jp</a> (東京都)</li>
<li>データ項目
陽性者数, 総検査実施件数, 発熱等相談件数</li>

</ul>
</blockquote>
<ul>
<li><p>
作業ディレクトリのdata内に置いて読み込む場合
</p>
<div class="org-src-container">

<pre class="src src-R">tc_data <span style="color: #60aa00;">&lt;-</span> read_csv(file=<span style="color: #d08928;">"data/tokyo_covid19_2021.csv"</span>)
</pre>
</div></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org840b054">
<h2 id="org840b054">描画の基礎</h2>
<div class="outline-text-2" id="text-org840b054">
</div>
</section>
<section id="slide-org0cb4993">
<h3 id="org0cb4993">描画の初期化</h3>
<ul>
<li><p>
<code>package::ggplot2</code> ではさまざまな作図関数を演算子 <code>+</code> で追加しながら描画する
</p>
<div class="org-src-container">

<pre class="src src-R">&#21021;&#26399;&#21270;&#12398;&#12383;&#12417;&#12398;&#38306;&#25968; + 
  &#20316;&#22259;&#12398;&#12383;&#12417;&#12398;&#38306;&#25968; + ... +
  &#35013;&#39166;&#12398;&#12383;&#12417;&#12398;&#38306;&#25968; + ... <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#38306;&#25968;&#12364;&#29983;&#25104;&#12377;&#12427;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12395;&#22793;&#26356;&#20998;&#12434;&#38543;&#26178;&#36861;&#21152;&#12377;&#12427;</span>
</pre>
</div></li>
<li><p>
関数 <code>ggplot2::ggplot()</code> : 初期化
</p>
<div class="org-src-container">

<pre class="src src-R">ggplot(data = <span style="color: #00aa80;">NULL</span>, mapping = aes(), ..., environment = parent.frame())
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> mapping: &#25551;&#30011;&#12398;&#22522;&#26412;&#12392;&#12394;&#12427;"&#23529;&#32654;&#30340;&#12510;&#12483;&#12503;"(xy&#36600;&#65292;&#33394;&#65292;&#24418;&#65292;&#22615;&#12426;&#28528;&#12375;&#12394;&#12393;)&#12398;&#35373;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> environment: &#20114;&#25563;&#24615;&#12398;&#12383;&#12417;&#12398;&#22793;&#25968;(&#24259;&#27490;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::ggplot' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-orgf942c19">
<h3 id="orgf942c19">折線グラフ</h3>
<ul>
<li><p>
関数 <code>ggplot2::geom_line()</code> : 線の描画
</p>
<div class="org-src-container">

<pre class="src src-R">geom_line(
  mapping = <span style="color: #00aa80;">NULL</span>,
  data = <span style="color: #00aa80;">NULL</span>,
  stat = <span style="color: #d08928;">"identity"</span>,
  position = <span style="color: #d08928;">"identity"</span>,
  ...,
  na.rm = <span style="color: #00aa80;">FALSE</span>, orientation = <span style="color: #00aa80;">NA</span>, show.legend = <span style="color: #00aa80;">NA</span>, inherit.aes = <span style="color: #00aa80;">TRUE</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> mapping: "&#23529;&#32654;&#30340;"&#12510;&#12483;&#12503;&#12398;&#35373;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> stat: &#32113;&#35336;&#30340;&#12394;&#20966;&#29702;&#12398;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> position: &#25551;&#30011;&#20301;&#32622;&#12398;&#35519;&#25972;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ...: &#12381;&#12398;&#20182;&#12398;&#25551;&#30011;&#12458;&#12503;&#12471;&#12519;&#12531;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> na.rm: NA(&#27424;&#25613;&#20516;)&#12398;&#21066;&#38500;(&#26082;&#23450;&#20516;&#12399;&#21066;&#38500;&#12375;&#12394;&#12356;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> show.legend: &#20961;&#20363;&#12398;&#34920;&#31034;(&#26082;&#23450;&#20516;&#12399;&#34920;&#31034;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::geom_line' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">東京の5月の気温と日射量の推移</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month == 5) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">5&#26376;&#12434;&#25277;&#20986;</span>
  ggplot(aes(x = day)) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">day &#12434;x&#36600;&#12395;&#25351;&#23450;</span>
  geom_line(aes(y = temp), colour = <span style="color: #d08928;">"blue"</span>) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#27671;&#28201;&#12434;&#38738;</span>
  geom_line(aes(y = solar), colour = <span style="color: #d08928;">"red"</span>) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26085;&#23556;&#37327;&#12434;&#36196;</span>
  labs(y = <span style="color: #d08928;">"temp.(blue) / solar rad.(red)"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">y&#36600;&#12398;&#12521;&#12505;&#12523;&#12434;&#22793;&#26356; </span>
</pre>
</div>


<div id="org1c8c4f1" class="figure">
<p><img src="figs/05-geomline-geomline.png" alt="05-geomline-geomline.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-org698aef0">
<h3 id="org698aef0">データフレームの形の変更</h3>
<ul>
<li><p>
関数 <code>dplyr::pivot_longer()</code> : 列の集約
</p>
<div class="org-src-container">

<pre class="src src-R">pivot_longer(
  data,
  cols,
  ...,
  cols_vary = <span style="color: #d08928;">"fastest"</span>,
  names_to = <span style="color: #d08928;">"name"</span>, names_prefix = <span style="color: #00aa80;">NULL</span>, names_sep = <span style="color: #00aa80;">NULL</span>, names_pattern = <span style="color: #00aa80;">NULL</span>,
  names_ptypes = <span style="color: #00aa80;">NULL</span>, names_transform = <span style="color: #00aa80;">NULL</span>, names_repair = <span style="color: #d08928;">"check_unique"</span>,
  values_to = <span style="color: #d08928;">"value"</span>, values_drop_na = <span style="color: #00aa80;">FALSE</span>, values_ptypes = <span style="color: #00aa80;">NULL</span>,
  values_transform = <span style="color: #00aa80;">NULL</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> cols: &#25805;&#20316;&#12398;&#23550;&#35937;&#12392;&#12377;&#12427;&#21015;(&#21015;&#12398;&#30058;&#21495;&#65292;&#21517;&#21069;&#65292;&#21517;&#21069;&#12395;&#38306;&#12377;&#12427;&#26465;&#20214;&#24335;&#12394;&#12393;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> names_to: &#23550;&#35937;&#12398;&#21015;&#21517;&#12434;&#12521;&#12505;&#12523;&#12392;&#12377;&#12427;&#26032;&#12375;&#12356;&#21015;&#12398;&#21517;&#21069;(&#26082;&#23450;&#20516;&#12399;"name")</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> values_to: &#23550;&#35937;&#12398;&#21015;&#12398;&#20516;&#12434;&#20445;&#23384;&#12377;&#12427;&#26032;&#12375;&#12356;&#21015;&#12398;&#21517;&#21069;(&#26082;&#23450;&#20516;&#12399;"value")</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?dplyr::pivot_longer' &#12434;&#21442;&#29031;</span>
</pre>
</div>
<ul>
<li>列ごとのグラフを視覚化する際に多用する</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">東京の5月の気温と日射量の推移</span> 
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month == 5) |&gt;
  pivot_longer(cols = c(temp, solar)) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#38598;&#32004;&#12377;&#12427;&#21015;&#12434;&#25351;&#23450;</span>
  ggplot(aes(x = day, y = value, colour = name)) + 
  geom_line() + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">index &#12372;&#12392;&#12395;&#23450;&#32681;&#12373;&#12428;&#12383;&#12459;&#12521;&#12540;&#12497;&#12524;&#12483;&#12488;&#12398;&#30064;&#12394;&#12427;&#33394;&#12364;&#29992;&#12356;&#12425;&#12428;&#12427;</span>
  labs(title = <span style="color: #d08928;">"Weather in May"</span>)
</pre>
</div>


<div id="org2dab200" class="figure">
<p><img src="figs/05-geomline.png" alt="05-geomline.png" width="50%" />
</p>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">個別のグラフでの描画</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month == 5) |&gt; 
  pivot_longer(c(temp, solar)) |&gt; 
  ggplot(aes(x = day, y = value, colour = name)) +
  geom_line(show.legend  =  <span style="color: #00aa80;">FALSE</span>) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20961;&#20363;&#12399;&#19981;&#35201;&#12394;&#12398;&#12391;&#28040;&#12377;</span>
  labs(title = <span style="color: #d08928;">"Weather in May"</span>) +
  facet_grid(rows = vars(name)) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">name &#12372;&#12392;&#12395;&#34892;&#12395;&#20006;&#12409;&#12427; (rows&#12399;&#30465;&#30053;&#21487;)</span>
</pre>
</div>


<div id="org0b45c3a" class="figure">
<p><img src="figs/05-geomline-facetgrid.png" alt="05-geomline-facetgrid.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-org987f02f">
<h3 id="org987f02f">図の保存</h3>
<ul>
<li>RStudioの機能を使う (少数の場合はこちらが簡便)
<ul>
<li>右下ペイン <b>Plots</b> タブから <b>Export</b> をクリック</li>
<li>形式やサイズを指定する</li>
<li>クリップボードにコピーもできる</li>

</ul></li>
<li><p>
関数 <code>ggsave()</code> : 図の保存
</p>
<div class="org-src-container">

<pre class="src src-R">ggsave(
  filename,
  plot = last_plot(),
  device = <span style="color: #00aa80;">NULL</span>,
  path = <span style="color: #00aa80;">NULL</span>, scale = 1, width = <span style="color: #00aa80;">NA</span>, height = <span style="color: #00aa80;">NA</span>,
  units = c(<span style="color: #d08928;">"in"</span>, <span style="color: #d08928;">"cm"</span>, <span style="color: #d08928;">"mm"</span>, <span style="color: #d08928;">"px"</span>), dpi = 300, limitsize = <span style="color: #00aa80;">TRUE</span>, bg = <span style="color: #00aa80;">NULL</span>,
  ...
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> filename: &#12501;&#12449;&#12452;&#12523;&#21517;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> plot: &#20445;&#23384;&#12377;&#12427;&#25551;&#30011;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> device: &#20445;&#23384;&#12377;&#12427;&#24418;&#24335;("pdf","jpeg","png"&#12394;&#12393;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399;"?ggplot2::ggsave"&#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-orga0a756d" data-background="#fef4f4">
<h2 id="orga0a756d">実習</h2>
</section>
<section id="slide-org19db12c" data-background="#fef4f4">
<h3 id="org19db12c">練習問題</h3>
<ul>
<li><code>tokyo_weather.csv</code> (東京都の気候データ)
を用いて以下の問に答えよ
<ul>
<li>6月の気温と湿度の折線グラフを描け</li>
<li>1年間の気温と湿度の折線グラフを描け</li>
<li>各月の平均気温と湿度の折線グラフを描け</li>
<li><p>
(参考) 読み込み方
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> CSV&#12501;&#12449;&#12452;&#12523;&#12399;&#20316;&#26989;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#19979;&#12398; data &#12469;&#12502;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12395;&#12354;&#12427;&#12392;&#12377;&#12427;</span>
tw_data <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/tokyo_weather.csv"</span>)
</pre>
</div></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org939f5ed">
<h2 id="org939f5ed">散布図の描画</h2>
<div class="outline-text-2" id="text-org939f5ed">
</div>
</section>
<section id="slide-orgc465dd9">
<h3 id="orgc465dd9">散布図</h3>
<ul>
<li><p>
関数 <code>ggplot2::geom_point()</code> : 点の描画
</p>
<div class="org-src-container">

<pre class="src src-R">geom_point(
  mapping = <span style="color: #00aa80;">NULL</span>,
  data = <span style="color: #00aa80;">NULL</span>,
  stat = <span style="color: #d08928;">"identity"</span>,
  position = <span style="color: #d08928;">"identity"</span>,
  ...,
  na.rm = <span style="color: #00aa80;">FALSE</span>, show.legend = <span style="color: #00aa80;">NA</span>, inherit.aes = <span style="color: #00aa80;">TRUE</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> mapping: &#23529;&#32654;&#30340;&#12510;&#12483;&#12503;&#12398;&#35373;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> stat: &#32113;&#35336;&#30340;&#12394;&#20966;&#29702;&#12398;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> position: &#25551;&#30011;&#20301;&#32622;&#12398;&#35519;&#25972;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ...: &#12381;&#12398;&#20182;&#12398;&#25551;&#30011;&#12458;&#12503;&#12471;&#12519;&#12531;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> na.rm: NA(&#27424;&#25613;&#20516;)&#12398;&#21066;&#38500;(&#26082;&#23450;&#20516;&#12399;&#21066;&#38500;&#12375;&#12394;&#12356;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> show.legend: &#20961;&#20363;&#12398;&#34920;&#31034;(&#26082;&#23450;&#20516;&#12399;&#34920;&#31034;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::geom_point' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">夏季の日射量と気温の関係</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month <span style="color: #60aa00;">%in%</span> 7:9) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">7&#26376;-9&#26376;&#12434;&#25277;&#20986;</span>
  ggplot(aes(x = solar, y = temp)) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">x&#36600;&#12434;&#26085;&#23556;&#37327;&#65292;y&#36600;&#12434;&#27671;&#28201;&#12395;&#35373;&#23450;</span>
  geom_point(colour = <span style="color: #d08928;">"blue"</span>, shape = 19) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#33394;&#12392;&#24418;&#12434;&#25351;&#23450;(&#28857;&#12398;&#24418;&#12399; '?points' &#12434;&#21442;&#29031;)</span>
  labs(x = <span style="color: #d08928;">"solar radiation"</span>, y = <span style="color: #d08928;">"temperature"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#36600;&#12398;&#21517;&#21069;&#12434;&#25351;&#23450;</span>
</pre>
</div>


<div id="orgbd452b5" class="figure">
<p><img src="figs/05-geompoint.png" alt="05-geompoint.png" width="50%" />
</p>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">湿度の情報を追加</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month <span style="color: #60aa00;">%in%</span> 7:9) |&gt; 
  ggplot(aes(x = solar, y = temp, size = humid)) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#28287;&#24230;&#12434;&#28857;&#12398;&#22823;&#12365;&#12373;&#12391;&#34920;&#31034;</span>
  geom_point(colour = <span style="color: #d08928;">"blue"</span>, shape = 19) + 
  labs(x = <span style="color: #d08928;">"solar radiation"</span>, y = <span style="color: #d08928;">"temperature"</span>)
</pre>
</div>


<div id="org497f8e7" class="figure">
<p><img src="figs/05-geompoint-size.png" alt="05-geompoint-size.png" width="50%" />
</p>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">各軸を対数表示</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month <span style="color: #60aa00;">%in%</span> 7:9) |&gt; 
  ggplot(aes(x = solar, y = temp, size = humid)) + 
  geom_point(colour = <span style="color: #d08928;">"blue"</span>, shape = 19) + 
  labs(x = <span style="color: #d08928;">"solar radiation"</span>, y = <span style="color: #d08928;">"temperature"</span>) +
  scale_x_log10() + scale_y_log10() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">x&#36600;&#65292;y&#36600;&#12434;&#23550;&#25968;&#34920;&#31034;</span>
</pre>
</div>


<div id="orge1485f1" class="figure">
<p><img src="figs/05-geompoint-scalelog.png" alt="05-geompoint-scalelog.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-org6eb2e47">
<h3 id="org6eb2e47">散布図行列</h3>
<ul>
<li>複数の散布図を行列状に配置したもの</li>
<li><p>
関数 GGally::ggpairs() : 散布図行列の描画
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#24517;&#35201;&#12391;&#12354;&#12428;&#12400; 'install.packages("GGally")' &#12434;&#23455;&#34892;</span>
<span style="color: #60aa00;">library</span>(GGally) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#12525;&#12540;&#12489;</span>
ggpairs(
  data, mapping = <span style="color: #00aa80;">NULL</span>,
  columns = 1:ncol(data),
  upper = list(continuous = <span style="color: #d08928;">"cor"</span>, combo = <span style="color: #d08928;">"box_no_facet"</span>, discrete = <span style="color: #d08928;">"count"</span>, na = <span style="color: #d08928;">"na"</span>),
  lower = list(continuous = <span style="color: #d08928;">"points"</span>, combo = <span style="color: #d08928;">"facethist"</span>, discrete = <span style="color: #d08928;">"facetbar"</span>, na = <span style="color: #d08928;">"na"</span>),
  diag = list(continuous = <span style="color: #d08928;">"densityDiag"</span>, discrete = <span style="color: #d08928;">"barDiag"</span>, na = <span style="color: #d08928;">"naDiag"</span>),
  ...,
  axisLabels = c(<span style="color: #d08928;">"show"</span>, <span style="color: #d08928;">"internal"</span>, <span style="color: #d08928;">"none"</span>),
  columnLabels = colnames(data[columns]),
  legend = <span style="color: #00aa80;">NULL</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> columns: &#34920;&#31034;&#12377;&#12427;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#21015;&#12434;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> upper/lower/diag: &#34892;&#21015;&#12398;&#19978;&#19977;&#35282;&#12539;&#19979;&#19977;&#35282;&#12539;&#23550;&#35282;&#12398;&#34920;&#31034;&#20869;&#23481;&#12434;&#35373;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> axisLabels: &#21508;&#12464;&#12521;&#12501;&#12398;&#36600;&#21517;&#12398;&#25201;&#12356;&#26041;&#12434;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> columnLabels: &#34920;&#31034;&#12377;&#12427;&#21015;&#12398;&#12521;&#12505;&#12523;&#12434;&#35373;&#23450;(&#26082;&#23450;&#20516;&#12399;&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;&#12398;&#21015;&#21517;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> legend: &#20961;&#20363;&#12398;&#35373;&#23450;(&#12393;&#12398;&#25104;&#20998;&#12434;&#20351;&#12358;&#12363;&#25351;&#23450;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?GGally::ggpairs' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">気温と日射量と湿度の関係を視覚化</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month <span style="color: #60aa00;">%in%</span> 7:9) |&gt; 
  select(temp, solar, humid) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#24517;&#35201;&#12394;&#21015;&#12434;&#36984;&#25246;</span>
  ggpairs() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#27161;&#28310;&#12398;&#25955;&#24067;&#22259;&#34892;&#21015; (&#19978;&#19977;&#35282;&#12399;&#30456;&#38306;&#65292;&#23550;&#35282;&#12399;&#23494;&#24230;&#65292;&#19979;&#19977;&#35282;&#12399;&#25955;&#24067;&#22259;)</span>
</pre>
</div>


<div id="org1020fd5" class="figure">
<p><img src="figs/05-ggpairs.png" alt="05-ggpairs.png" width="50%" />
</p>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">月ごとに情報を整理</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; filter(month <span style="color: #60aa00;">%in%</span> 7:9) |&gt; select(month, temp, solar, humid) |&gt;
  mutate(month = as_factor(month)) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26376;&#12434;&#22240;&#23376;&#21270;(&#12521;&#12505;&#12523;&#12392;&#12375;&#12390;&#25201;&#12358;)</span>
  ggpairs(columns = 2:4, legend = c(1,1), <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#34920;&#31034;&#12377;&#12427;&#21015;&#65294;&#20961;&#20363;&#12398;&#38619;&#22411;</span>
          aes(colour = month), <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26376;&#12372;&#12392;&#12395;&#33394;&#12389;&#12369;&#12427;</span>
          diag = list(continuous = <span style="color: #d08928;">"barDiag"</span>)) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#23550;&#35282;&#12434;&#12498;&#12473;&#12488;&#12464;&#12521;&#12512;</span>
  theme(legend.position = <span style="color: #d08928;">"top"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20961;&#20363;(&#19978;&#12391;&#25351;&#23450;&#12375;&#12383;1&#34892;1&#21015;&#12398;&#20961;&#20363;)&#12398;&#20301;&#32622;</span>
</pre>
</div>


<div id="orgd161467" class="figure">
<p><img src="figs/05-ggpairs-quarter.png" alt="05-ggpairs-quarter.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-org00b361e">
<h3 id="org00b361e">対話型のグラフ</h3>
<ul>
<li><code>ggplot2</code> で描画したグラフは
対話型 (interactive) のグラフに変換することができる</li>
<li><p>
変換には <code>package::plotly</code> が必要 
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#26368;&#21021;&#12395;&#19968;&#24230;&#12384;&#12369;&#20197;&#19979;&#12398;&#12356;&#12378;&#12428;&#12363;&#12434;&#23455;&#34892;&#12375;&#12390;&#12362;&#12367;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;">  - Package &#12479;&#12502;&#12363;&#12425; plotly &#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;">  - &#12467;&#12531;&#12477;&#12540;&#12523;&#19978;&#12391;&#27425;&#12398;&#12467;&#12510;&#12531;&#12489;&#12434;&#23455;&#34892; 'install.packages("plotly")'</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> plotly &#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#35501;&#12415;&#36796;&#12415;</span>
<span style="color: #60aa00;">library</span>(plotly)
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
関数 <code>plotly::ggplotly()</code> : 対話型への変換
</p>
<div class="org-src-container">

<pre class="src src-R">ggplotly(
  p = ggplot2::last_plot(),
  width = <span style="color: #00aa80;">NULL</span>, height = <span style="color: #00aa80;">NULL</span>, tooltip = <span style="color: #d08928;">"all"</span>, dynamicTicks = <span style="color: #00aa80;">FALSE</span>,
  layerData = 1, originalData = <span style="color: #00aa80;">TRUE</span>, source = <span style="color: #d08928;">"A"</span>,
  ...
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> p: ggplot &#12458;&#12502;&#12472;&#12455;&#12463;&#12488;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?plotly::ggplotly' &#12434;&#21442;&#29031;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> https://plotly.com/ggplot2/</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">前出のグラフの変換例</span>
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> 5&#26376;&#12398;&#27671;&#28201;&#12392;&#26085;&#23556;&#37327;&#12398;&#20363;</span>
tw_data |&gt; filter(month == 5) |&gt; select(day, temp, solar) |&gt;
  pivot_longer(!day, names_to = <span style="color: #d08928;">"index"</span>) |&gt; 
  ggplot(aes(x = day, y = value, colour = index)) +
  geom_line() + labs(title = <span style="color: #d08928;">"Weather in May"</span>)
ggplotly() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26368;&#24460;&#12395;&#25551;&#12356;&#12383; ggplot &#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#22793;&#25563;&#12375;&#12390; &#21491;&#19979; Viewer &#12479;&#12502;&#12395;&#34920;&#31034;</span>
</pre>
</div>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#22799;&#23395;&#12398;&#26085;&#23556;&#37327;&#12392;&#28201;&#24230;&#12392;&#28287;&#24230;&#12398;&#20363;</span>
bar <span style="color: #60aa00;">&lt;-</span> <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">ggplot &#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#20445;&#23384;</span>
  tw_data |&gt; filter(month <span style="color: #60aa00;">%in%</span> 7:9) |&gt; 
  ggplot(aes(x = solar, y = temp, size = humid,
             text = paste0(<span style="color: #d08928;">"date: "</span>, month, <span style="color: #d08928;">"/"</span>, day))) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26085;&#20184;&#12434;&#20184;&#21152;</span>
  geom_point(colour = <span style="color: #d08928;">"blue"</span>, shape = 19) + 
  labs(x = <span style="color: #d08928;">"solar radiation"</span>, y = <span style="color: #d08928;">"temperature"</span>)
ggplotly(bar) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20445;&#23384;&#12375;&#12383; ggplot &#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12434;&#22793;&#25563;</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org54ab477">
<h3 id="org54ab477">日本語に関する注意 (主にmacOS)</h3>
<ul>
<li>日本語を含む図で文字化けが起こる場合がある</li>
<li><p>
以下のように日本語フォントを指定する必要がある
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #6c9ef8;">if</span>(Sys.info()[<span style="color: #d08928;">"sysname"</span>] == <span style="color: #d08928;">"Darwin"</span>) { <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">macOS &#12363;&#35519;&#12409;&#12427;</span>
  <span style="color: #808080; font-style: italic;">#</span><span style="color: #808080; font-style: italic;">' OS&#27161;&#28310;&#12398;&#12498;&#12521;&#12462;&#12494;&#12501;&#12457;&#12531;&#12488;&#12434;&#25351;&#23450;&#12377;&#12427;&#22580;&#21512;</span>
  theme_update(text = element_text(family = <span style="color: #d08928;">"HiraginoSans-W4"</span>))
  <span style="color: #808080; font-style: italic;">#</span><span style="color: #808080; font-style: italic;">' gome_text/geom_label&#20869;&#12391;&#29992;&#12356;&#12425;&#12428;&#12427;&#26085;&#26412;&#35486;&#12501;&#12457;&#12531;&#12488;&#12398;&#25351;&#23450;</span>
  update_geom_defaults(<span style="color: #d08928;">"text"</span>, list(family = theme_get()$text$family))
  update_geom_defaults(<span style="color: #d08928;">"label"</span>, list(family = theme_get()$text$family))}
</pre>
</div>
<ul>
<li>以下のサイトなども参考になる <br />
<a href="https://oku.edu.mie-u.ac.jp/~okumura/stat/font.html">https://oku.edu.mie-u.ac.jp/~okumura/stat/font.html</a></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgef47e88" data-background="#fef4f4">
<h2 id="orgef47e88">実習</h2>
</section>
<section id="slide-org89758a2" data-background="#fef4f4">
<h3 id="org89758a2">練習問題</h3>
<ul>
<li><code>jpdata1/3.csv</code> (前回配布のデータ)を用いて以下の問に答えよ．
<ul>
<li>人口1000人あたりの婚姻・離婚数の散布図を描け．</li>
<li>地方別に異なる点の形状を用いた散布図を描け．</li>
<li>それ以外にも様々な散布図を描画してみよう．</li>
<li><p>
(参考) 読み込み方
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> CSV&#12501;&#12449;&#12452;&#12523;&#12399;&#20316;&#26989;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#19979;&#12398; data &#12469;&#12502;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12395;&#12354;&#12427;&#12392;&#12377;&#12427;</span>
jp_data <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata1.csv"</span>)
jp_area <span style="color: #60aa00;">&lt;-</span> read_csv(file = <span style="color: #d08928;">"data/jpdata3.csv"</span>)
</pre>
</div></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org8709693">
<h2 id="org8709693">さまざまなグラフ</h2>
<div class="outline-text-2" id="text-org8709693">
</div>
</section>
<section id="slide-org01f0ad1">
<h3 id="org01f0ad1">ヒストグラム</h3>
<ul>
<li>データの値の範囲をいくつかの区間に分割し，
各区間に含まれるデータの個数を棒グラフにした図
<ul>
<li>棒グラフの幅が区間, 面積が区間に含まれるデータの個数に比例するようにグラフを作成</li>
<li>データ分布の可視化に有効(値の集中とばらつきを調べる)</li>

</ul></li>
<li><p>
関数 <code>ggplot2::geom_histogram()</code> : 
</p>
<div class="org-src-container">

<pre class="src src-R">geom_histogram(
  mapping = <span style="color: #00aa80;">NULL</span>, data = <span style="color: #00aa80;">NULL</span>, stat = <span style="color: #d08928;">"bin"</span>, position = <span style="color: #d08928;">"stack"</span>,
  ...,
  binwidth = <span style="color: #00aa80;">NULL</span>,
  bins = <span style="color: #00aa80;">NULL</span>,
  na.rm = <span style="color: #00aa80;">FALSE</span>, orientation = <span style="color: #00aa80;">NA</span>, show.legend = <span style="color: #00aa80;">NA</span>, inherit.aes = TREU
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> binwidth: &#12498;&#12473;&#12488;&#12464;&#12521;&#12512;&#12398;&#12499;&#12531;&#12398;&#24133;&#12434;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> bins: &#12498;&#12473;&#12488;&#12464;&#12521;&#12512;&#12398;&#12499;&#12531;&#12398;&#25968;&#12434;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::geom_histogram' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">日射量の分布</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt;
  ggplot(aes(x = solar)) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20998;&#24067;&#12434;&#25551;&#30011;&#12377;&#12427;&#21015;&#12434;&#25351;&#23450;</span>
  geom_histogram(bins = 30, fill = <span style="color: #d08928;">"pink"</span>, colour = <span style="color: #d08928;">"red"</span>) +
  labs(x = expression(MJ/m^2), <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#25968;&#24335;&#12398;&#34920;&#31034;&#12399; '?plotmath' &#12434;&#21442;&#29031;</span>
       title = <span style="color: #d08928;">"Solar Radiation in Tokyo"</span>)
</pre>
</div>


<div id="orgcb38ebb" class="figure">
<p><img src="figs/05-geomhistogram.png" alt="05-geomhistogram.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-orgce77bfb">
<h3 id="orgce77bfb">密度</h3>
<ul>
<li>データからカーネル法で確率密度を推定した図
<ul>
<li>ヒストグラム同様データ分布の可視化に有効</li>
<li>カーネルの幅や関数も選択可能</li>

</ul></li>
<li><p>
関数 <code>ggplot2::geom_density()</code> : 
</p>
<div class="org-src-container">

<pre class="src src-R">geom_density(
  mapping = <span style="color: #00aa80;">NULL</span>, data = <span style="color: #00aa80;">NULL</span>, stat = <span style="color: #d08928;">"density"</span>, position = <span style="color: #d08928;">"identity"</span>,
  ...,
  na.rm = <span style="color: #00aa80;">FALSE</span>, orientation = <span style="color: #00aa80;">NA</span>, show.legend = <span style="color: #00aa80;">NA</span>, inherit.aes = <span style="color: #00aa80;">TRUE</span>,
  outline.type = <span style="color: #d08928;">"upper"</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::geom_density' &#12434;&#21442;&#29031;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#12459;&#12540;&#12493;&#12523;&#12398;&#24133;&#12420;&#38306;&#25968;&#12395;&#12388;&#12356;&#12390;&#12399; '?stat::density' &#12434;&#21442;&#29031;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> bw: &#12459;&#12540;&#12493;&#12523;&#12398;&#24133;&#12398;&#35336;&#31639;&#26041;&#27861; "nrd0", "ucv" &#12394;&#12393;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> kernel: &#12459;&#12540;&#12493;&#12523;&#38306;&#25968; "gaussian", "epanechnikov" &#12394;&#12393;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">日射量の分布</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt;
  ggplot(aes(x = solar)) + 
  geom_density(fill = <span style="color: #d08928;">"pink"</span>, colour = <span style="color: #d08928;">"red"</span>) + 
  labs(x = expression(MJ/m^2), 
       title = <span style="color: #d08928;">"Solar Radiation in Tokyo"</span>)
</pre>
</div>


<div id="orgb625d27" class="figure">
<p><img src="figs/05-geomdensity.png" alt="05-geomdensity.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-orgf273835">
<h3 id="orgf273835">箱ひげ図</h3>
<ul>
<li>データの散らばり具合を考察するための図
<ul>
<li>長方形の辺は四分位点(下端が第1，中央が第2，上端が第3)</li>
<li>中央値から第1四分位点・第3四分位点までの1.5倍以内にあるデータの
最小の値・最大の値を下端・上端とする線(ひげ)</li>
<li>ひげの外側の点は外れ値</li>

</ul></li>
<li><p>
関数 <code>ggplot2::geom_boxplot()</code> :
</p>
<div class="org-src-container">

<pre class="src src-R">geom_boxplot(
  mapping = <span style="color: #00aa80;">NULL</span>, data = <span style="color: #00aa80;">NULL</span>, stat = <span style="color: #d08928;">"boxplot"</span>, position = <span style="color: #d08928;">"dodge2"</span>,
  ...,
  outlier.colour = <span style="color: #00aa80;">NULL</span>, outlier.color = <span style="color: #00aa80;">NULL</span>, outlier.fill = <span style="color: #00aa80;">NULL</span>,
  outlier.shape = 19, outlier.size = 1.5, outlier.stroke = 0.5, outlier.alpha = <span style="color: #00aa80;">NULL</span>,
  notch = <span style="color: #00aa80;">FALSE</span>, notchwidth = 0.5, varwidth = <span style="color: #00aa80;">FALSE</span>,
  na.rm = <span style="color: #00aa80;">FALSE</span>, orientation = <span style="color: #00aa80;">NA</span>, show.legend = <span style="color: #00aa80;">NA</span>, inherit.aes = <span style="color: #00aa80;">TRUE</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> ourlier.*: &#22806;&#12428;&#20516;&#12398;&#25551;&#30011;&#26041;&#27861;&#12398;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> notch*: &#12508;&#12483;&#12463;&#12473;&#12398;&#20999;&#12428;&#36796;&#12415;&#12398;&#35373;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> varwidth: &#12508;&#12483;&#12463;&#12473;&#12398;&#24133;&#12391;&#12487;&#12540;&#12479;&#25968;&#12434;&#34920;&#31034;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::geom_boxplot' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">月ごとの日射量の分布(分位点)</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt;
  mutate(month = as_factor(month)) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26376;&#12434;&#22240;&#23376;(&#12521;&#12505;&#12523;)&#21270;</span>
  ggplot(aes(x = month, y = solar)) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26376;&#27598;&#12395;&#38598;&#35336;&#12377;&#12427;</span>
  geom_boxplot(fill = <span style="color: #d08928;">"orange"</span>) + <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#22615;&#12426;&#28528;&#12375;&#12398;&#33394;&#12434;&#25351;&#23450;</span>
  labs(title = <span style="color: #d08928;">"Solar Radiation in Tokyo"</span>)
</pre>
</div>


<div id="org0f89220" class="figure">
<p><img src="figs/05-geomboxplot.png" alt="05-geomboxplot.png" width="50%" />
</p>
</div></li>

</ul>
</section>
<section id="slide-org43b55b1">
<h3 id="org43b55b1">棒グラフ</h3>
<ul>
<li><p>
項目ごとの量を並べて表示した図
</p>
<ul>
<li>並べ方はいくつか用意されている
<ul>
<li>積み上げ (stack)</li>
<li>横並び (dodge)</li>
<li>比率の表示 (fill)</li>

</ul></li>

</ul>
<div class="org-src-container">

<pre class="src src-R">geom_bar(
  mapping = <span style="color: #00aa80;">NULL</span>, data = <span style="color: #00aa80;">NULL</span>, stat = <span style="color: #d08928;">"count"</span>, position = <span style="color: #d08928;">"stack"</span>,
  ...,
  just = 0.5,
  width = <span style="color: #00aa80;">NULL</span>,
  na.rm = <span style="color: #00aa80;">FALSE</span>, orientation = <span style="color: #00aa80;">NA</span>, show.legend = <span style="color: #00aa80;">NA</span>, inherit.aes = <span style="color: #00aa80;">TRUE</span>
)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> just: &#30446;&#30427;&#12392;&#26834;&#12398;&#20301;&#32622;&#12398;&#35519;&#25972;(&#26082;&#23450;&#20516;&#12399;&#30495;&#20013;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> width: &#26834;&#12398;&#24133;&#12398;&#35519;&#25972;(&#26082;&#23450;&#20516;&#12399;&#30446;&#30427;&#12398;&#38291;&#38548;&#12398;90%)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#35443;&#32048;&#12399; '?ggplot2::geom_bar' &#12434;&#21442;&#29031;</span>
</pre>
</div></li>

</ul>

</section>
<section>
<ul>
<li><p>
<span style="color:green;">月ごとの日射量・降水量・降雪量の合計値の推移</span>
</p>
<div class="org-src-container">

<pre class="src src-R">tw_data |&gt; 
  mutate(month = as_factor(month)) |&gt; group_by(month) |&gt;
  summarize(across(c(solar, rain, wind), mean)) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26376;&#12372;&#12392;&#12395;&#38598;&#35336;</span>
  pivot_longer(!month) |&gt; <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">long format &#12395;&#22793;&#26356;</span>
  ggplot(aes(x = name, y = value, fill = month)) +
  geom_bar(stat = <span style="color: #d08928;">"identity"</span>, position = <span style="color: #d08928;">"dodge"</span>, na.rm = <span style="color: #00aa80;">TRUE</span>) +
  theme(legend.position = <span style="color: #d08928;">"top"</span>) + guides(fill = guide_legend(nrow = 2))
</pre>
</div>


<div id="orgc57f184" class="figure">
<p><img src="figs/05-geombar.png" alt="05-geombar.png" width="50%" />
</p>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-org7f6b322" data-background="#fef4f4">
<h2 id="org7f6b322">実習</h2>
</section>
<section id="slide-org5f9f7cf" data-background="#fef4f4">
<h3 id="org5f9f7cf">練習問題</h3>
<ul>
<li><code>tokyo_covid19_2021.csv</code> (東京都の新型コロナの動向データ)
を用いて以下の問に答えよ
<ul>
<li>陽性者数と陽性率の推移の折線グラフを描け</li>
<li>月ごとの総検査実施件数の推移の棒グラフを描け</li>
<li>曜日ごとの総検査実施件数の箱ひげ図を描け．</li>
<li><p>
(参考) 読み込み方
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> CSV&#12501;&#12449;&#12452;&#12523;&#12399;&#20316;&#26989;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12398;&#19979;&#12398; data &#12469;&#12502;&#12487;&#12451;&#12524;&#12463;&#12488;&#12522;&#12395;&#12354;&#12427;&#12392;&#12377;&#12427;</span>
tc_data <span style="color: #60aa00;">&lt;-</span> read_csv(file=<span style="color: #d08928;">"data/tokyo_covid19_2021.csv"</span>)
</pre>
</div></li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org13f83a8">
<h2 id="org13f83a8">次回の予定</h2>
<ul>
<li>計算機による数値実験</li>
<li>乱数とは</li>
<li>乱数を用いた数値実験</li>

</ul>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/menu/menu.js"></script>
<script src="./reveal.js/plugin/spotlight/spotlight.js"></script>
<script src="./reveal.js/plugin/chalkboard/plugin.js"></script>
<script src="./reveal.js/dist/theme/hidelinks.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
showNotes: window.location.search.match( /print-pdf/gi ) ? 'separate-page' : false,
spotlight: { size: 80, initialPresentationMode: false, }, keyboard: { 81: function() { RevealSpotlight.toggleSpotlight()}, 87: function() { RevealSpotlight.togglePresentationMode();}, },

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealMenu, RevealSpotlight, RevealChalkboard ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>

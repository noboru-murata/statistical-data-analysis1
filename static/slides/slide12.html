<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>分散分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/plugin/toc-progress/toc-progress.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/toc-style.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/accessibility/helper.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/mycourse.css"/>
<link rel="stylesheet" href="./reveal.js/plugin/highlight/zenburn.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide" data-state="no-toc-progress">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">分散分析</h1>
</div>
<div class="talk-subtitle">
    <p>複数のグループ間の違いを検証する</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>

<section>
<section id="slide-orgf07a90d">
<h2 id="orgf07a90d">講義の内容</h2>
<ul>
<li>分散分析とは</li>
<li>一元配置
<ul>
<li>一元配置のモデル</li>
<li>検定の構成</li>

</ul></li>
<li>二元配置
<ul>
<li>二元配置のモデル</li>
<li>検定の構成</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org33760dd">
<h2 id="org33760dd">分散分析とは</h2>
<div class="outline-text-2" id="text-org33760dd">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orge7c4dd8">
<h3 id="orge7c4dd8">分散分析</h3>
<ul>
<li>平均の差の検定: <br />
<b>2つのグループ間</b> で平均の差があるか否か</li>
<li>分散分析: <br />
<b>2つ以上のグループ間</b> で平均の差があるか否か</li>
<li><p>
<span style="color:darkgreen;">分散分析における仮説の例</span>:
</p>
<blockquote>
<ul>
<li>ある小売店について&ldquo;売上高は月によって差があるか&rdquo;</li>
<li>ある銘柄の株価について&ldquo;収益率は曜日によって差があるか&rdquo;</li>

</ul>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org9ff35e2">
<h3 id="org9ff35e2">基本的な考え方</h3>
<ul>
<li>データの変動 (<b>分散</b>) =不確定性を分解:
<ul>
<li>グループ間での変動</li>
<li>観測誤差のみに起因する変動</li>

</ul></li>
<li>変動の大きさを比較:
<ul>
<li>平均に差がない: 自由度を除いて両者に本質的な差がない</li>
<li>平均に差がある: グループ間の変動が増してより大きくなる</li>

</ul></li>
<li>分散分析は <b>&ldquo;データの変動の分析&rdquo;</b></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org24a15c8">
<h2 id="org24a15c8">分散の比の検定 (再掲)</h2>
<div class="outline-text-2" id="text-org24a15c8">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org42f86ba">
<h3 id="org42f86ba">分散の比の検定</h3>
<ul>
<li><p>
2種類のデータの分散が等しいか否かを検定する
</p>
<blockquote>
<div>
\begin{equation}
  H_0:\sigma_1^2=\sigma_2^2\quad\text{vs}\quad H_1:\sigma_1^2\neq\sigma_2^2
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgcdb8d07">
<h3 id="orgcdb8d07">考え方</h3>
<ul>
<li>\(X_1,\dotsc,X_m\) および \(Y_1,\dotsc,Y_n\)
の不偏分散: \(s_1^2\), \(s_2^2\)</li>

</ul>

<ul>
<li>このとき \(s_1^2,s_2^2\) は独立でそれぞれ
<ul>
<li>\((m{-}1)s_1^2/\sigma_1^2\)
は自由度 \(m{-}1\) の \(\chi^2\)-分布に従う</li>
<li>\((n{-}1)s_2^2/\sigma_2^2\)
は自由度 \(n{-}1\) の \(\chi^2\)-分布に従う</li>

</ul></li>
<li><p>
検定統計量:
</p>
<blockquote>
<div>
\begin{equation}
  F=\frac{s_1^2}{s_2^2}
  \left(
    =
    \frac
    {((m{-}1)s_1^2/\sigma_1^2)/(m{-}1)}
    {((n{-}1)s_2^2/\sigma_2^2)/(n{-}1)}
  \right)
\end{equation}

</div>
</blockquote></li>
<li>帰無分布は自由度 \(m{-}1,n{-}1\) の \(F\)-分布
(<b>\(F\)-検定</b>)</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org836bca4">
<h3 id="org836bca4">両側検定の棄却域</h3>
<ul>
<li>有意水準を選択: \(\alpha\in(0,1)\)</li>
<li><p>
\(H_0\) の下では以下が成立:
</p>
<blockquote>
<div>
\begin{equation}
  P(F < F_{\alpha/2}(m{-}1,n{-}1)
  \text{ または }F > F_{1{-}\alpha/2}(m{-}1,n{-}1))=\alpha
\end{equation}

</div>
</blockquote>
<ul>
<li>自由度 \(m{-}1,n{-}1\) の \(F\) 分布
<ul>
<li>\(F_{\alpha/2}(m{-}1,n{-}1)\) : \(\alpha/2\) 分位点</li>
<li>\(F_{1{-}\alpha/2}(m{-}1,n{-}1)\) : \(1{-}\alpha/2\) 分位点</li>

</ul></li>

</ul></li>
<li><p>
第一種過誤の上限が \(\alpha\) の棄却域:
</p>
<blockquote>
<div>
\begin{equation}
  R_{\alpha}=
  \left(-\infty,F_{\alpha/2}(m{-}1,n{-}1)\right)
  \cup\left(F_{1{-}\alpha/2}(m{-}1,n{-}1),\infty\right)
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>データから検定統計量 \(F\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<blockquote>
<div>
\begin{equation}
  F < F_{\alpha/2}(m{-}1,n{-}1)
  \text{ または }F>F_{1{-}\alpha/2}(m{-}1,n{-}1)
\end{equation}

</div>
</blockquote></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org129c3e8">
<h2 id="org129c3e8">一元配置</h2>
<div class="outline-text-2" id="text-org129c3e8">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orgc7daed2">
<h3 id="orgc7daed2">一元配置の問題設定</h3>
<ul>
<li>グループ分けが1種類: \(p\) グループ
\(A_1,A_2,\dotsc,A_p\)</li>
<li><p>
各グループ \(i\) ごとに \(n_i\) 個のデータを観測
</p>
<blockquote>
<div>
\begin{equation}
  Y_{i1},Y_{i2},\dotsc,Y_{in_i},\quad (i=1,2,\dotsc,p)
\end{equation}

</div>
</blockquote></li>
<li><p>
<span style="color:darkgreen;">小売店の売上高の問題</span>
</p>
<blockquote>
<ul>
<li>\(A_1,A_2,\dotsc,A_p\): 月</li>
<li>\(Y_{i1},Y_{i2},\dotsc,Y_{in_i}\): \(i\) 月の各日における売上高</li>

</ul>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd2bbd7c">
<h3 id="orgd2bbd7c">一元配置のモデル</h3>
<ul>
<li>分散分析の用語:
<ul>
<li><b>因子</b>: グループ分けのこと (<span style="color:darkgreen;">月ごと</span>)</li>
<li><b>水準</b>: 因子内の各グループのこと (<span style="color:darkgreen;">1月，2月，3月，…</span>)</li>

</ul></li>
<li><p>
観測データのモデル:
</p>
<blockquote>
<div>
\begin{equation}
  Y_{ij}=\mu_i+\varepsilon_{ij}\quad(i=1,\dotsc,p;\;j=1,\dotsc,n_i).
\end{equation}

</div>
</blockquote></li>
<li>モデルの仮定:
<ul>
<li>水準 \(A_i\) における観測データの平均値 \(\mu_i\) は定数</li>
<li>\(\varepsilon_{ij}\) は独立同分布(平均0, 分散 \(\sigma^2\) の正規分布)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org5f95097">
<h3 id="org5f95097">一元配置の検定</h3>
<ul>
<li><p>
検定問題
</p>
<blockquote>
<p>
各水準 \(A_1,A_2,\dotsc,A_p\)
の平均 \(\mu_1,\mu_2,\dotsc,\mu_{p}\)
に差があるか否かを検定する
</p>
</blockquote>
<ul>
<li>帰無仮説: 全ての水準で平均に差はない</li>
<li>対立仮説: 平均の異なる水準がある</li>

</ul>
<blockquote>
<div>
\begin{equation}
  H_0:\mu_1=\cdots=\mu_p\quad\text{vs}\quad
  H_1:\text{ある\(i,j\)に対して}\mu_i\neq\mu_j.
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgebfaa34">
<h3 id="orgebfaa34">分析の考え方</h3>
<ul>
<li>データの変動から因子間での変動と観測誤差の変動を抽出して比較</li>
<li><p>
各種平均: (\(n=\sum_{i=1}^pn_i\) は全サンプル数)
</p>
<blockquote>
<div>
\begin{align}
  &\text{(全データの標本平均)}
  &\bar{Y}_{\cdot\cdot}&=\frac{1}{n}\sum_{i=1}^p\sum_{j=1}^{n_i}Y_{ij},\\
  &\text{(水準\(A_i\)の標本平均)}
  &\bar{Y}_{i\cdot}&=\frac{1}{n_i}\sum_{j=1}^{n_i}Y_{ij}\quad
		     (i=1,\dotsc,p).
\end{align}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
各種変動:
</p>
<blockquote>
<div>
\begin{align}
  &\text{(全変動)}
  &SS_T&=\sum_{i=1}^p\sum_{j=1}^{n_i}(Y_{ij}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(級内変動)}
  &SS_W&=\sum_{i=1}^p\sum_{j=1}^{n_i}(Y_{ij}-\bar{Y}_{i\cdot})^2,\\
  &\text{(級間変動)}
  &SS_B&=\sum_{i=1}^p\sum_{j=1}^{n_i}(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2
	 =\sum_{i=1}^pn_i(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2.
\end{align}

</div>
</blockquote>
<ul>
<li><b>級内変動</b>: 各水準内でのデータの変動 (観測誤差に起因)</li>
<li><b>級間変動</b>: 水準間でのデータの変動 (水準ごとのデータ数で重みづけ)</li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
変動の分解:
</p>
<blockquote>
<div>
\begin{equation}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }n{-}1}
  =\underbrace{\text{(級内変動) }SS_W}_{\text{自由度 }n{-}p}
  +\underbrace{\text{(級間変動) }SS_B}_{\text{自由度 }p{-}1}
\end{equation}

</div>
</blockquote></li>
<li>帰無仮説 \(H_0\) が正しい:
<ul>
<li>水準内・水準間でのデータの変動はともに観測誤差が原因</li>
<li>自由度を除けば本質的な違いはない</li>
<li>\(SS_T/(n{-}1)\) は \(\sigma^2\) の不偏推定量</li>
<li>\(SS_W/(n{-}p)\), \(SS_B/(p{-}1)\) もともに \(\sigma^2\) の不偏推定量</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
変動の分解:
</p>
<blockquote>
<div>
\begin{equation}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }n{-}1}
  =\underbrace{\text{(級内変動) }SS_W}_{\text{自由度 }n{-}p}
  +\underbrace{\text{(級間変動) }SS_B}_{\text{自由度 }p{-}1}
\end{equation}

</div>
</blockquote></li>
<li>対立仮説 \(H_1\) が正しい:
<ul>
<li>水準間での変動 \(SS_B\) は観測誤差と平均値の差に影響される</li>
<li>\(SS_B\) は \(SS_W\) より本質的に大きくなる</li>

</ul></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org678b25c">
<h3 id="org678b25c">一元配置の検定</h3>
<ul>
<li><p>
検定統計量:
</p>
<blockquote>
<div>
\begin{equation}
  F=\frac{SS_B/(p{-}1)}{SS_W/(n{-}p)}
\end{equation}

</div>
</blockquote></li>
<li>帰無仮説の下で次の事実が成り立つ:
<ul>
<li>\(SS_B,SS_W\) は独立</li>
<li>\(SS_B\) は自由度 \(p{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\(SS_W\) は自由度 \(n{-}p\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li>帰無分布は自由度 \(p{-}1,n{-}p\) の \(F\) 分布に従う</li>
<li>対立仮説の下 \(F\) は大きな値をとるので右片側検定</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org23f1e9a">
<h3 id="org23f1e9a">棄却域を用いる場合</h3>
<ul>
<li>有意水準を選択: \(\alpha\in(0,1)\)</li>
<li>自由度 \(p{-}1,n{-}p\) の \(F\) 分布
<ul>
<li>\(F_{1{-}\alpha}(p{-}1,n{-}p)\) : \(1{-}\alpha\) 分位点</li>

</ul></li>
<li><p>
\(H_0\) の下で以下が成立:
</p>
<blockquote>
<div>
\begin{equation}
  P(F>F_{1{-}\alpha}(p{-}1,n{-}p))=\alpha
\end{equation}

</div>
</blockquote></li>
<li><p>
第一種過誤の上限が \(\alpha\) となる棄却域:
</p>
<blockquote>
<div>
\begin{equation}
  R_{\alpha}=
  \left(F_{1{-}\alpha}(p{-}1,n{-}p),\infty\right)
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>データから検定統計量 \(F\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<blockquote>
<div>
\begin{equation}
  F>F_{1{-}\alpha}(p{-}1,n{-}p)
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org96ce578">
<h3 id="org96ce578">\(p\)-値を用いる場合</h3>
<ul>
<li><p>
\(p\) 値を用いる方法: \(p\) 値を計算
</p>
<blockquote>
<div>
\begin{equation}
  \text{(\(p\)-値)}=\int_{F}^\infty f(x)dx
\end{equation}

</div>
</blockquote>
<ul>
<li>\(f(x)\) は自由度 \(p{-}1,n{-}p\) の \(F\) 分布の密度</li>

</ul></li>
<li>\(p\) 値が \(\alpha\) 未満なら帰無仮説を棄却</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgf469767">
<h3 id="orgf469767">分散分析表 (一元配置の場合)</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">自由度</th>
<th scope="col" class="org-left">平方和</th>
<th scope="col" class="org-left">平均平方和</th>
<th scope="col" class="org-left">\(F\) 値</th>
<th scope="col" class="org-left">\(p\) 値</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">級間</td>
<td class="org-left">\(p{-}1\)</td>
<td class="org-left">\(SS_B\)</td>
<td class="org-left">\(SS_B/(p{-}1)\)</td>
<td class="org-left">\(F\)</td>
<td class="org-left">\(\mathstrut\int_{F}^\infty f(x)dx\)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">級内</td>
<td class="org-left">\(n{-}p\)</td>
<td class="org-left">\(SS_W\)</td>
<td class="org-left">\(SS_W/(n{-}p)\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">全変動</td>
<td class="org-left">\(n{-}1\)</td>
<td class="org-left">\(SS_T\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<ul>
<li>\(f(x)\) は自由度 \(p{-}1,n{-}p\) の \(F\) 分布の密度</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb2b88a5">
<h3 id="orgb2b88a5">モデルの別表現</h3>
<ul>
<li>各水準の平均値の相対効果による定式化:
<ul>
<li>因子 \(A\) 全体の平均効果: \(\mu\)</li>
<li>平均 \(\mu\) を基準とした各水準 \(A_i\) の相対的な効果: \(\alpha_i\)</li>
<li><p>
平均値の別表現:
</p>
<blockquote>
<div>
\begin{equation}
    \mu_i=\mu+\alpha_i,\quad
    \mu=\frac{1}{n}\sum_{i=1}^pn_i\mu_i,\quad
    \sum_{i=1}^pn_i\alpha_i=0
\end{equation}

</div>
</blockquote></li>

</ul></li>
<li><p>
帰無仮説 \(H_0\) は以下と同等:
</p>
<blockquote>
<div>
\begin{equation}
  \alpha_1=\cdots=\alpha_p=0
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org0578bab">
<h3 id="org0578bab">分散分析の関数</h3>
<ul>
<li><p>
基本書式 
</p>
<div class="org-src-container">

<pre><code class=" R" >res &lt;- aov(formula, data)
## formula: 式，一元配置の場合は (観測値 ~ 因子)
## data: データフレーム
## 分析の結果を参照する関数がいくつかあるので，多くの場合適当なオブジェクトに代入
</code></pre>
</div></li>
<li><p>
分散分析表の表示
</p>
<div class="org-src-container">

<pre><code class=" R" >summary(res) # res は上記の分析を保存したオブジェクト
anova(res) # summaryと同様な情報を表示，こちらは data.frame になっている
model.tables(res, type="means")   # 平均値
model.tables(res, type="effects") # 効果
</code></pre>
</div></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org71131fc">
<h3 id="org71131fc">分散分析の関数(検定のみ)</h3>
<ul>
<li><p>
基本書式 
</p>
<div class="org-src-container">

<pre><code class=" R" >oneway.test(formula, data, subset, na.action, var.equal = FALSE)
## formula: 式
## data: データフレーム
## subset: subsetの指定
## na.action: 欠損値の扱い
## var.equal: 等分散を仮定する場合は TRUE，標準では Welch の近似が用いられる
</code></pre>
</div></li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org025d77f" data-background="#fef4f4">
<h2 id="org025d77f">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-orge334268" data-background="#fef4f4">
<h3 id="orge334268">練習問題</h3>
<ul>
<li>東京都の気候データ (<code>tokyo_weather.csv</code>) の
気温の項目について以下の問に答えよ．
<ul>
<li><p>
曜日ごとの気温の平均と分散を求めよ．
</p>
<div class="org-src-container">

<pre><code class=" R" >## 週日を因子(factor)とするには例えば以下のような項目を加えればよい
TW.data &lt;- read.csv("data/tokyo_weather.csv")
days &lt;- with(TW.data, # 日付を取り出して整形する
	     as.Date(paste(year,month,day,sep="-"))) 
wdays &lt;- weekdays(days) # 各日付の曜日を計算
TW.data &lt;- cbind(TW.data, weekday=as.factor(wdays)) # 曜日因子を追加
</code></pre>
</div></li>
<li>曜日ごとに平均が異なるといえるかどうか分散分析を用いて検定しなさい．</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org56b5151">
<h2 id="org56b5151">二元配置</h2>
<div class="outline-text-2" id="text-org56b5151">
</div>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org69ee38f">
<h3 id="org69ee38f">二元配置の問題</h3>
<ul>
<li>因子が2種類ある場合
<ul>
<li>一方の因子の水準の平均値に差があるか否かを検定</li>
<li>もう一方の因子の水準で平均値に差があるかは不問</li>

</ul></li>
<li><p>
<span style="color:darkgreen;">複数の薬の治験の問題</span>
</p>
<blockquote>
<p>
複数の薬の効能を複数の被験者に投与する実験
</p>
<ul>
<li>&ldquo;薬の種類&rdquo;と&ldquo;被験者番号&rdquo;の2種類の因子</li>
<li>&ldquo;薬の種類&rdquo;という因子での薬の効能の差を検証したい</li>
<li>&ldquo;被験者番号&rdquo;という因子で効能に差があることは許容したい
(薬の効き目には個人差があると考えられるため)</li>

</ul>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgbf85533">
<h3 id="orgbf85533">二元配置のモデル</h3>
<ul>
<li>2種類の因子 \(A, B\)
<ul>
<li>因子 \(A\) には \(a\) 個の水準: \(A_1,\dotsc,A_a\)</li>
<li>因子 \(B\) には \(b\) 個の水準: \(B_1,\dotsc,B_b\)</li>
<li>因子 \(A,B\) の水準がそれぞれ \(A_i,B_j\) である観測値: \(Y_{ij}\)</li>
<li><span style="color:gray;">各水準ごとに1つの観測値が得られる一番簡単な場合を想定</span></li>

</ul></li>
<li><p>
観測データのモデル:
</p>
<blockquote>
<div>
\begin{equation}
  Y_{ij}=\alpha_i+\beta_j+\varepsilon_{ij}\quad
  (i=1,\dotsc,a;\;j=1,\dotsc,b).
\end{equation}

</div>
</blockquote></li>
<li>モデルの仮定:
<ul>
<li>因子 \(A,B\) の水準 \(A_i,B_j\) における効果
\(\alpha_i,\beta_j\) は定数</li>
<li>\(\varepsilon_{ij}\) は独立同分布 (平均0, 分散 \(\sigma^2\) の正規分布)</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgf15af25">
<h3 id="orgf15af25">二元配置の例</h3>
<ul>
<li><span style="color:darkgreen;">複数の薬の治験の問題</span>
<ul>
<li>因子
<ul>
<li>因子 \(A\): &ldquo;薬の種類&rdquo;</li>
<li>因子 \(B\): &ldquo;被験者番号&rdquo;</li>

</ul></li>
<li>効果
<ul>
<li>\(\alpha_i\): 薬 \(A_i\) の効能</li>
<li>\(\beta_j\): 被験者 \(B_j\) 固有の薬の効きやすさ</li>

</ul></li>
<li>薬の効能に差があるか否かという検定</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgd82fea4">
<h3 id="orgd82fea4">二元配置の検定</h3>
<ul>
<li><p>
検定問題
</p>
<blockquote>
<p>
因子 \(A\) の各水準の効果に差があるか否かを検定する
</p>
</blockquote>
<ul>
<li>帰無仮説: 因子 \(A\) の効果 \(\alpha_{i}\) に差はない</li>
<li><p>
対立仮説: 因子 \(A\) の効果に差のあるものがある
</p>
<blockquote>
<div>
\begin{equation}
  H_0:\alpha_1=\cdots=\alpha_a\quad\text{vs}\quad
  H_1:\text{ある\(i_1,i_2\)に対して}\alpha_{i_1}\neq\alpha_{i_2}.
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orga1c82f6">
<h3 id="orga1c82f6">分析の考え方</h3>
<ul>
<li>データの変動から因子間での変動と観測誤差の変動を抽出して比較</li>
<li><p>
各種平均: (\(n=ab\))
</p>
<blockquote>
<div>
\begin{align}
  &\text{(全データの標本平均)}
  &\bar{Y}_{\cdot\cdot}&=\frac{1}{n}\sum_{i=1}^a\sum_{j=1}^{b}Y_{ij},\\
  &\text{(水準\(A_i\)の標本平均)}
  &\bar{Y}_{i\cdot}&=\frac{1}{b}\sum_{j=1}^bY_{ij}\quad
		     (i=1,\dotsc,a),\\
  &\text{(水準\(B_j\)の標本平均)}
  &\bar{Y}_{\cdot j}&=\frac{1}{a}\sum_{i=1}^aY_{ij}\quad
		      (j=1,\dotsc,b).
\end{align}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
因子効果の推定量としての標本平均:
</p>
<blockquote>
<div>
\begin{align}
  \bar{Y}_{i\cdot}
  &\to\alpha_i+\frac{1}{b}\sum_{j=1}^b\beta_j,\\
  \bar{Y}_{\cdot j}
  &\to\frac{1}{a}\sum_{i=1}^a\alpha_i+\beta_j,\\
  \bar{Y}_{\cdot\cdot}
  &\to\frac{1}{ab}\sum_{i=1}^a\sum_{j=1}^b(\alpha_i+\beta_j)=\frac{1}{a}\sum_{i=1}^a\alpha_i+\frac{1}{b}\sum_{j=1}^b\beta_j
\end{align}

</div>
<div>
\begin{equation}
  Y_{ij}-\bar{Y}_{i\cdot}
  -\bar{Y}_{\cdot j}+\bar{Y}_{\cdot\cdot}
  \to\varepsilon_{ij}
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
各種変動:
</p>
<blockquote>
<div>
\begin{align}
  &\text{(行間変動)}
  &SS_A&=b\sum_{i=1}^a(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(列間変動)}
  &SS_B&=a\sum_{j=1}^b(\bar{Y}_{\cdot j}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(誤差変動)}
  &SS_E&=\sum_{i=1}^a\sum_{j=1}^b(Y_{ij}-\bar{Y}_{i\cdot}
	 -\bar{Y}_{\cdot j}+\bar{Y}_{\cdot\cdot})^2.
\end{align}

</div>
</blockquote>
<ul>
<li><b>行間変動</b>: 水準 \(A\) 内でのデータの変動</li>
<li><b>列間変動</b>: 水準 \(B\) 内でのデータの変動</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
変動の分解:
</p>
<blockquote>
<div>
\begin{multline}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }ab-1}
  =\underbrace{\text{(行間変動) }SS_A}_{\text{自由度 }a-1}\\
  +\underbrace{\text{(列間変動) }SS_B}_{\text{自由度 }b-1}
  +\underbrace{\text{(誤差変動) }SS_E}_{\text{自由度 }(a-1)(b-1)}
\end{multline}

</div>
</blockquote></li>
<li>帰無仮説 \(H_0\) が正しい:
<ul>
<li>変動 \(SS_A,SS_E\) はともに観測誤差のみが原因で生じる</li>
<li>自由度を除けば本質的な違いはない</li>
<li>\(SS_A/(a{-}1)\), \(SS_E/\{(a{-}1)(b{-}1)\}\) は \(\sigma^2\) の不偏推定量</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
変動の分解:
</p>
<blockquote>
<div>
\begin{multline}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }ab-1}
  =\underbrace{\text{(行間変動) }SS_A}_{\text{自由度 }a-1}\\
  +\underbrace{\text{(列間変動) }SS_B}_{\text{自由度 }b-1}
  +\underbrace{\text{(誤差変動) }SS_E}_{\text{自由度 }(a-1)(b-1)}
\end{multline}

</div>
</blockquote></li>
<li>対立仮説 \(H_1\) が正しい:
<ul>
<li>因子 \(A\) 内の水準間での効果 \(\alpha_1,\dotsc,\alpha_a\) の差に影響される</li>
<li>\(SS_A\) は \(SS_E\) より本質的に大きくなる</li>

</ul></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org8dbd9a2">
<h3 id="org8dbd9a2">二元配置の検定</h3>
<ul>
<li><p>
検定統計量:
</p>
<blockquote>
<div>
\begin{equation}
  F_A=\frac{SS_A/(a{-}1)}{SS_E/\{(a{-}1)(b{-}1)\}}
\end{equation}

</div>
</blockquote></li>
<li>帰無仮説の下で次の事実が成り立つ:
<ul>
<li>\(SS_A,SS_E\) は独立</li>
<li>\(SS_A\) は自由度 \(a{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\(SS_E\) は自由度 \((a{-}1)(b{-}1)\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li>帰無仮説の下 \(F_A\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布に従う</li>
<li>対立仮説の下 \(F_A\) は大きな値をとるので右片側検定</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org2632088">
<h3 id="org2632088">棄却域を用いる場合</h3>
<ul>
<li>有意水準: \(\alpha\in(0,1)\)</li>
<li>自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布
<ul>
<li>\(F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1))\) : \(1{-}\alpha\) 分位点</li>

</ul></li>
<li><p>
\(H_0\) の下で以下が成立:
</p>
<blockquote>
<div>
\begin{equation}
  P(F_A>F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1)))=\alpha
\end{equation}

</div>
</blockquote></li>
<li><p>
第一種過誤の上限が \(\alpha\) となる棄却域:
</p>
<blockquote>
<div>
\begin{equation}
  R_{\alpha}=
  (F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1)),\infty)
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li>データから検定統計量 \(F_A\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<blockquote>
<div>
\begin{equation}
  F_A>F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1))
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orga48bbce">
<h3 id="orga48bbce">\(p\)-値を用いる場合</h3>
<ul>
<li><p>
値を計算
</p>
<blockquote>
<div>
\begin{equation}
  \text{(\(p\)-値)}=\int_{F_A}^\infty f(x)dx
\end{equation}

</div>
</blockquote>
<ul>
<li>\(f\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布の確率密度関数</li>

</ul></li>
<li>\(p\) 値が \(\alpha\) 未満なら帰無仮説を棄却</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-org8255f48">
<h3 id="org8255f48">分散分析表 (二元配置の場合)</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">自由度</th>
<th scope="col" class="org-left">平方和</th>
<th scope="col" class="org-left">平均平方和</th>
<th scope="col" class="org-left">\(F\text{値}\)</th>
<th scope="col" class="org-left">\(p\text{値}\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(\text{因子}A\)</td>
<td class="org-left">\(a{-}1\)</td>
<td class="org-left">\(SS_A\)</td>
<td class="org-left">\(\displaystyle\frac{SS_A}{a{-}1}\)</td>
<td class="org-left">\(F_A\)</td>
<td class="org-left">\(\displaystyle\int_{F_A}^\infty f(x)dx\)</td>
</tr>

<tr>
<td class="org-left">\(\text{因子}B\)</td>
<td class="org-left">\(b{-}1\)</td>
<td class="org-left">\(SS_B\)</td>
<td class="org-left">\(\displaystyle\frac{SS_B}{b{-}1}\)</td>
<td class="org-left">\(F_B\)</td>
<td class="org-left">\(\displaystyle\int_{F_B}^\infty f(x)dx\)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">\(\text{誤差}\)</td>
<td class="org-left">\((a{-}1)(b{-}1)\)</td>
<td class="org-left">\(SS_E\)</td>
<td class="org-left">\(\displaystyle\frac{SS_E}{(a{-}1)(b{-}1)}\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<ul>
<li>\(f\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布の確率密度関数</li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orge9513ef">
<h3 id="orge9513ef">モデルの別表現</h3>
<p>
相対効果による定式化:
</p>
<ul>
<li><p>
モデルの書き換え:
</p>
<blockquote>
<div>
\begin{align}
  \mu^*&=\bar{\alpha}+\bar{\beta},&
				    \alpha^*_i&=\alpha_i-\bar{\alpha},&
									\beta^*_j&=\beta_j-\bar{\beta}\\
       &&\bar{\alpha}&=\frac{1}{a}\sum_{i=1}^a\alpha_i,
					      &\bar{\beta}&=\frac{1}{b}\sum_{j=1}^b\beta_j
\end{align}

</div>
<div>
\begin{equation}
  Y_{ij}=\mu^*+\alpha^*_i+\beta^*_j+\varepsilon_{ij}\quad
  (i=1,\dotsc,a;\;j=1,\dotsc,b)
\end{equation}

</div>
<div>
\begin{equation}
  \text{ただし }\sum_{i=1}^a\alpha^*_i=\sum_{j=1}^b\beta^*_j=0
\end{equation}

</div>
</blockquote></li>

</ul>
<div class="slide-footer"><br></div>
</section>
<section>
<ul>
<li><p>
帰無仮説 \(H_0\) は以下と同等:
</p>
<blockquote>
<div>
\begin{equation}
  \alpha^*_1=\cdots=\alpha^*_a=0
\end{equation}

</div>
</blockquote></li>

</ul>

<div class="slide-footer"><br></div>
</section>
<section id="slide-orgb617ca4">
<h3 id="orgb617ca4">分散分析の関数</h3>
<ul>
<li><p>
基本書式 
</p>
<div class="org-src-container">

<pre><code class=" R" >aov(formula, data)
## formula: 式，二元配置の場合は (観測値 ~ 因子 + 因子)
## data: データフレーム
</code></pre>
</div></li>
<li>分散分析表なども同様</li>

</ul>


<div class="slide-footer"><br></div>
</section>
</section>
<section>
<section id="slide-org8ee4671" data-background="#fef4f4">
<h2 id="org8ee4671">演習</h2>
<div class="slide-footer"><br></div>
</section>
<section id="slide-org8016591" data-background="#fef4f4">
<h3 id="org8016591">練習問題</h3>
<ul>
<li><p>
パッケージ <code>datarium</code> をインストールして，
そこに含まれている <code>jobsatisfaction</code> データ
(性別 (<code>gender</code>) と学歴 (<code>education_level</code>) の違いによる
仕事の満足度 (<code>score</code>) を収集したデータ) 
について以下の問に答えよ．
</p>
<div class="org-src-container">

<pre><code class=" R" >## パッケージのインストールと読み込みは以下のように行うことができる
install.packages("datarium") # インストール
library(datarium) # 読み込み
</code></pre>
</div>
<ul>
<li>データを適当な方法で可視化しなさい．</li>
<li>それぞれの因子で満足度の平均に違いがあるか
二元配置の分散分析を用いて検討しなさい．</li>

</ul></li>

</ul>
<div class="slide-footer"><br></div>
</section>
</section>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/highlight/highlight.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,

overview: true,

transition: 'fade',
transitionSpeed: 'default',
spotlight: { size: 90, initialPresentationMode: false }, chalkboard: { toggleChalkboardButton: { left: '80px' }, toggleNotesButton: { left: '130px'}}, keyboard: { 69: function() { RevealChalkboard.toggleNotesCanvas() }, 87: function() { RevealChalkboard.toggleChalkboard() }, 67: function() { RevealChalkboard.clear() }, 82: function() { RevealChalkboard.reset() }, 68: function() { RevealChalkboard.download() }, 88: function() { RevealChalkboard.colorNext() }, 89: function() { RevealChalkboard.colorPrev() }, 84: function() { RevealSpotlight.toggleSpotlight() }, 81: function() { RevealSpotlight.togglePresentationMode()}},

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealHighlight ],

// Optional libraries used to extend reveal.js
dependencies: [
{ src: './reveal.js/plugin/menu/menu.js'},
{ src: './reveal.js/plugin/chalkboard/chalkboard.js'},
{ src: './reveal.js/plugin/spotlight/spotlight.js'}]

});
</script>
</body>
</html>

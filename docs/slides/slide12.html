<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>分散分析</title>
<meta name="author" content="村田 昇"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="./reveal.js/dist/reveal.css"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/oer-reveal.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/dist/theme/fonts/source-sans-pro/source-sans-pro.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/menu.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/menu/font-awesome/css/fontawesome.css"/>

<link rel="stylesheet" href="./reveal.js/plugin/chalkboard/style.css"/>

<link rel="stylesheet" href="./reveal.js/local/mycourse.css"/>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide">
<!-- This is an HTML template for the title slide. -->
<!-- Embed logos as necessary. -->
<!-- <a class="nooutlink" href="url"><img class="state-background your-logo-class" src="whatever.png" alt="Whatever" /></a> -->
<div class="talk-title">
    <h1 class="no-toc-progress">分散分析</h1>
</div>
<div class="talk-subtitle">
    <p>第12講 - 複数のグループ間の違いを検証する</p>
</div>
<div class="keyboard-usage">
    <p>(Press <code>?</code> for help, <code>n</code> and <code>p</code> for next and previous slide)</p>
</div>
<div class="talk-author">
  <p>村田 昇<br />
  </p>
</div>

</section>
<section>
<section id="slide-org2ccb76e">
<h2 id="org2ccb76e">講義概要</h2>
<ul>
<li>分散分析とは</li>
<li>一元配置
<ul>
<li>一元配置のモデル</li>
<li>検定の構成</li>

</ul></li>
<li>二元配置
<ul>
<li>二元配置のモデル</li>
<li>検定の構成</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org0f2ed90">
<h2 id="org0f2ed90">分散分析とは</h2>
<div class="outline-text-2" id="text-org0f2ed90">
</div>
</section>
<section id="slide-orgaf8b3cd">
<h3 id="orgaf8b3cd">分散分析</h3>
<ul>
<li>平均の差の検定 <br />
<b>2つのグループ間</b> で平均の差があるか否か</li>
<li>分散分析 <br />
<b>2つ以上のグループ間</b> で平均の差があるか否か</li>
<li><p>
<span style="color:green;">分散分析における仮説の例</span>
</p>
<blockquote>
<ul>
<li>ある小売店について&ldquo;売上高は月によって差があるか&rdquo;</li>
<li>ある銘柄の株価について&ldquo;収益率は曜日によって差があるか&rdquo;</li>

</ul>
</blockquote></li>

</ul>
</section>
<section id="slide-orgc711130">
<h3 id="orgc711130">基本的な考え方</h3>
<ul>
<li>データの変動 (<b>分散</b>) =不確定性 を分解 
<ul>
<li>グループ間での変動</li>
<li>観測誤差のみに起因する変動</li>

</ul></li>
<li>変動の大きさを比較 
<ul>
<li>平均に差がない : 自由度を除いて両者に本質的な差がない</li>
<li>平均に差がある : グループ間の変動が増してより大きくなる</li>

</ul></li>
<li>分散分析は <b>&ldquo;データの変動の分析&rdquo;</b></li>

</ul>
</section>
</section>
<section>
<section id="slide-org351c80b">
<h2 id="org351c80b">分散の比の検定 (再掲)</h2>
<div class="outline-text-2" id="text-org351c80b">
</div>
</section>
<section id="slide-org0af7c13">
<h3 id="org0af7c13">分散の比の検定</h3>
<ul>
<li><p>
2種類のデータの分散が等しいか否かを検定する
</p>
<blockquote>
<div>
\begin{equation}
  H_0:\sigma_1^2=\sigma_2^2\quad\text{vs}\quad H_1:\sigma_1^2\neq\sigma_2^2
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orgf257c2f">
<h3 id="orgf257c2f">考え方</h3>
<ul>
<li>\(X_1,\dotsc,X_m\) および \(Y_1,\dotsc,Y_n\)
の不偏分散: \(s_1^2\), \(s_2^2\)

<ul>
<li>このとき \(s_1^2,s_2^2\) は独立でそれぞれ
<ul>
<li>\((m{-}1)s_1^2/\sigma_1^2\)
は自由度 \(m{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\((n{-}1)s_2^2/\sigma_2^2\)
は自由度 \(n{-}1\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li><p>
<b>\(F\) 検定</b>
</p>
<blockquote>
<div>
\begin{equation}
  \text{検定統計量 : }
  F=\frac{s_1^2}{s_2^2}
  \left(
    =
    \frac
    {((m{-}1)s_1^2/\sigma_1^2)/(m{-}1)}
    {((n{-}1)s_2^2/\sigma_2^2)/(n{-}1)}
  \right)
\end{equation}

</div>
</blockquote>
<ul>
<li>帰無分布は自由度 \(m{-}1,n{-}1\) の \(F\) 分布</li>

</ul></li>

</ul></li>

</ul>
</section>
<section id="slide-org8bb6f2f">
<h3 id="org8bb6f2f">両側検定の棄却域</h3>
<ul>
<li>有意水準を選択 : \(\alpha\in(0,1)\)</li>
<li><p>
\(H_0\) の下では以下が成立
</p>
<blockquote>
<div>
\begin{equation}
  P(F < F_{\alpha/2}(m{-}1,n{-}1)
  \text{ または }F > F_{1{-}\alpha/2}(m{-}1,n{-}1))=\alpha
\end{equation}

</div>
</blockquote>
<ul>
<li>自由度 \(m{-}1,n{-}1\) の \(F\) 分布
<ul>
<li>\(F_{\alpha/2}(m{-}1,n{-}1)\) : \(\alpha/2\) 分位点</li>
<li>\(F_{1{-}\alpha/2}(m{-}1,n{-}1)\) : \(1{-}\alpha/2\) 分位点</li>

</ul></li>

</ul></li>
<li><p>
第一種過誤の上限が \(\alpha\) の棄却域
</p>
<blockquote>
<div>
\begin{equation}
  R_{\alpha}=
  \left(-\infty,F_{\alpha/2}(m{-}1,n{-}1)\right)
  \cup\left(F_{1{-}\alpha/2}(m{-}1,n{-}1),\infty\right)
\end{equation}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li>データから検定統計量 \(F\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<blockquote>
<div>
\begin{equation}
  F < F_{\alpha/2}(m{-}1,n{-}1)
  \quad\text{または}\quad
  F>F_{1{-}\alpha/2}(m{-}1,n{-}1)
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
</section>
<section>
<section id="slide-orgbd30572">
<h2 id="orgbd30572">一元配置</h2>
<div class="outline-text-2" id="text-orgbd30572">
</div>
</section>
<section id="slide-org01e0b53">
<h3 id="org01e0b53">一元配置の問題設定</h3>
<ul>
<li>グループ分けが1種類 : \(p\) グループ
\(A_1,A_2,\dotsc,A_p\)</li>
<li><p>
各グループ \(i\) ごとに \(n_i\) 個のデータを観測
</p>
<blockquote>
<div>
\begin{equation}
  Y_{i1},Y_{i2},\dotsc,Y_{in_i},\quad (i=1,2,\dotsc,p)
\end{equation}

</div>
</blockquote></li>
<li><p>
<span style="color:green;">小売店の売上高の問題</span>
</p>
<blockquote>
<ul>
<li>\(A_1,A_2,\dotsc,A_p\) : 月</li>
<li>\(Y_{i1},Y_{i2},\dotsc,Y_{in_i}\) : \(i\) 月の各日における売上高</li>

</ul>
</blockquote></li>

</ul>
</section>
<section id="slide-org222f578">
<h3 id="org222f578">一元配置のモデル</h3>
<ul>
<li>分散分析の用語
<ul>
<li><b>因子</b> : グループ分けのこと (<span style="color:green;">月ごと</span>)</li>
<li><b>水準</b> : 因子内の各グループのこと (<span style="color:green;">1月，2月，3月，…</span>)</li>

</ul></li>
<li><p>
観測データのモデル
</p>
<blockquote>
<div>
\begin{equation}
  Y_{ij}=\mu_i+\varepsilon_{ij}\quad(i=1,\dotsc,p;\;j=1,\dotsc,n_i).
\end{equation}

</div>
</blockquote></li>
<li>モデルの仮定
<ul>
<li>水準 \(A_i\) における観測データの平均値 \(\mu_i\) は定数</li>
<li>\(\varepsilon_{ij}\) は独立同分布 (平均0, 分散 \(\sigma^2\) の正規分布)</li>

</ul></li>

</ul>
</section>
<section id="slide-org1edd7a4">
<h3 id="org1edd7a4">一元配置の検定</h3>
<ul>
<li><p>
検定問題
</p>
<blockquote>
<p>
各水準 \(A_1,A_2,\dotsc,A_p\)
の平均 \(\mu_1,\mu_2,\dotsc,\mu_{p}\)
に差があるか否かを検定する
</p>
</blockquote>
<ul>
<li>帰無仮説 : 全ての水準で平均に差はない</li>
<li>対立仮説 : 平均の異なる水準がある</li>

</ul>
<blockquote>
<div>
\begin{equation}
  H_0:\mu_1=\cdots=\mu_p\quad\text{vs}\quad
  H_1:\text{ある\(i,j\)に対して}\mu_i\neq\mu_j.
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orgcd70ccc">
<h3 id="orgcd70ccc">分析の考え方</h3>
<ul>
<li>データの変動から因子間での変動と観測誤差の変動を抽出して比較</li>
<li><p>
各種平均 (\(n=\sum_{i=1}^pn_i\) は全サンプル数)
</p>
<blockquote>
<div>
\begin{align}
  &\text{(全データの標本平均)}
  &\bar{Y}_{\cdot\cdot}&=\frac{1}{n}\sum_{i=1}^p\sum_{j=1}^{n_i}Y_{ij},\\
  &\text{(水準\(A_i\)の標本平均)}
  &\bar{Y}_{i\cdot}&=\frac{1}{n_i}\sum_{j=1}^{n_i}Y_{ij}\quad
                     (i=1,\dotsc,p).
\end{align}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li><p>
各種変動
</p>
<blockquote>
<div>
\begin{align}
  &\text{(全変動)}
  &SS_T&=\sum_{i=1}^p\sum_{j=1}^{n_i}(Y_{ij}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(級内変動)}
  &SS_W&=\sum_{i=1}^p\sum_{j=1}^{n_i}(Y_{ij}-\bar{Y}_{i\cdot})^2,\\
  &\text{(級間変動)}
  &SS_B&=\sum_{i=1}^p\sum_{j=1}^{n_i}(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2
         =\sum_{i=1}^pn_i(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2.
\end{align}

</div>
</blockquote>
<ul>
<li><b>級内変動</b> : 各水準内でのデータの変動の合計 (観測誤差に起因)</li>
<li><b>級間変動</b> : 水準間でのデータの変動の合計 (水準ごとのデータ数で重みづけ)</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
変動の分解
</p>
<blockquote>
<div>
\begin{equation}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }n{-}1}
  =\underbrace{\text{(級内変動) }SS_W}_{\text{自由度 }n{-}p}
  +\underbrace{\text{(級間変動) }SS_B}_{\text{自由度 }p{-}1}
\end{equation}

</div>
</blockquote></li>
<li>帰無仮説 \(H_0\) が正しい場合
<ul>
<li>水準内・水準間でのデータの変動はともに観測誤差が原因</li>
<li>自由度を除けば本質的な違いはない</li>
<li>\(SS_T/(n{-}1)\) は \(\sigma^2\) の不偏推定量</li>
<li>\(SS_W/(n{-}p)\), \(SS_B/(p{-}1)\) もともに \(\sigma^2\) の不偏推定量</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
変動の分解
</p>
<blockquote>
<div>
\begin{equation}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }n{-}1}
  =\underbrace{\text{(級内変動) }SS_W}_{\text{自由度 }n{-}p}
  +\underbrace{\text{(級間変動) }SS_B}_{\text{自由度 }p{-}1}
\end{equation}

</div>
</blockquote></li>
<li>対立仮説 \(H_1\) が正しい場合
<ul>
<li>水準間での変動 \(SS_B\) は観測誤差と平均値の差に影響される</li>
<li>\(SS_B\) は \(SS_W\) より本質的に大きくなる</li>

</ul></li>

</ul>
</section>
<section id="slide-org84e0107">
<h3 id="org84e0107">一元配置の検定</h3>
<ul>
<li><p>
検定統計量
</p>
<blockquote>
<div>
\begin{equation}
  F=\frac{SS_B/(p{-}1)}{SS_W/(n{-}p)}
\end{equation}

</div>
</blockquote></li>
<li>帰無仮説の下で次の事実が成り立つ
<ul>
<li>\(SS_B,SS_W\) は独立</li>
<li>\(SS_B\) は自由度 \(p{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\(SS_W\) は自由度 \(n{-}p\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li>帰無分布は自由度 \(p{-}1,n{-}p\) の \(F\) 分布に従う</li>
<li>対立仮説の下 \(F\) は大きな値をとるので右片側検定</li>

</ul>
</section>
<section id="slide-org0f3c9ca">
<h3 id="org0f3c9ca">棄却域を用いる場合</h3>
<ul>
<li>有意水準を選択 : \(\alpha\in(0,1)\)</li>
<li>自由度 \(p{-}1,n{-}p\) の \(F\) 分布
<ul>
<li>\(F_{1{-}\alpha}(p{-}1,n{-}p)\) : \(1{-}\alpha\) 分位点</li>

</ul></li>
<li><p>
\(H_0\) の下で以下が成立
</p>
<blockquote>
<div>
\begin{equation}
  P(F>F_{1{-}\alpha}(p{-}1,n{-}p))=\alpha
\end{equation}

</div>
</blockquote></li>
<li><p>
第一種過誤の上限が \(\alpha\) となる棄却域
</p>
<blockquote>
<div>
\begin{equation}
  R_{\alpha}=
  \left(F_{1{-}\alpha}(p{-}1,n{-}p),\infty\right)
\end{equation}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li>データから検定統計量 \(F\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<blockquote>
<div>
\begin{equation}
  F>F_{1{-}\alpha}(p{-}1,n{-}p)
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-org78fb8d7">
<h3 id="org78fb8d7">\(p\) 値を用いる場合</h3>
<ul>
<li><p>
\(p\) 値を計算 (右片側検定の場合の計算方法)
</p>
<blockquote>
<div>
\begin{equation}
  \text{(\(p\) 値)}=\int_{F}^\infty f(x)dx
\end{equation}

</div>
</blockquote>
<ul>
<li>\(f(x)\) は自由度 \(p{-}1,n{-}p\) の \(F\) 分布の確率密度</li>

</ul></li>
<li>\(p\) 値が \(\alpha\) 未満なら帰無仮説を棄却</li>

</ul>
</section>
<section id="slide-org9244f8e">
<h3 id="org9244f8e">分散分析表 (一元配置の場合)</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">自由度</th>
<th scope="col" class="org-left">平方和</th>
<th scope="col" class="org-left">平均平方和</th>
<th scope="col" class="org-left">\(F\) 値</th>
<th scope="col" class="org-left">\(p\) 値</th>
<th scope="col" class="org-left">&#xa0;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">級間</td>
<td class="org-left">\(p{-}1\)</td>
<td class="org-left">\(SS_B\)</td>
<td class="org-left">\(SS_B/(p{-}1)\)</td>
<td class="org-left">\(F\)</td>
<td class="org-left">\(\mathstrut\int_{F}^\infty f(x)dx\)</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">級内</td>
<td class="org-left">\(n{-}p\)</td>
<td class="org-left">\(SS_W\)</td>
<td class="org-left">\(SS_W/(n{-}p)\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">全変動</td>
<td class="org-left">\(n{-}1\)</td>
<td class="org-left">\(SS_T\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<ul>
<li>\(f(x)\) は自由度 \(p{-}1,n{-}p\) の \(F\) 分布の確率密度</li>

</ul>
</section>
<section id="slide-org0b6f59b">
<h3 id="org0b6f59b">モデルの別表現</h3>
<ul>
<li>各水準の平均値の相対効果による定式化
<ul>
<li>因子 \(A\) 全体の平均効果 : \(\mu\)</li>
<li>平均 \(\mu\) を基準とした各水準 \(A_i\) の相対的な効果 : \(\alpha_i\)</li>
<li><p>
平均値の別表現
</p>
<blockquote>
<div>
\begin{equation}
  \mu_i=\mu+\alpha_i,\quad
  \mu=\frac{1}{n}\sum_{i=1}^pn_i\mu_i,\quad
  \sum_{i=1}^pn_i\alpha_i=0
\end{equation}

</div>
</blockquote></li>

</ul></li>
<li><p>
帰無仮説 \(H_0\) は以下と同等
</p>
<blockquote>
<div>
\begin{equation}
  H_{0}:\alpha_1=\cdots=\alpha_p=0
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-org443b3a7">
<h3 id="org443b3a7">分散分析の計算</h3>
<ul>
<li><p>
基本書式 
</p>
<div class="org-src-container">

<pre class="src src-R">aov(formula, data)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> formula: &#24335;&#65292;&#19968;&#20803;&#37197;&#32622;&#12398;&#22580;&#21512;&#12399; (&#35251;&#28204;&#20516; ~ &#22240;&#23376;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#20998;&#26512;&#12398;&#32080;&#26524;&#12434;&#21442;&#29031;&#12377;&#12427;&#38306;&#25968;&#12364;&#12356;&#12367;&#12388;&#12363;&#12354;&#12427;&#12398;&#12391;&#65292;&#22810;&#12367;&#12398;&#22580;&#21512;&#36969;&#24403;&#12394;&#12458;&#12502;&#12472;&#12455;&#12463;&#12488;&#12395;&#20195;&#20837;</span>
</pre>
</div></li>
<li><p>
分散分析表の表示
</p>
<div class="org-src-container">

<pre class="src src-R">aov(formula, data) |&gt; summary()     <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#20998;&#26512;&#34920;&#24418;&#24335;&#12391;&#12398;&#34920;&#31034;</span>
aov(formula, data) |&gt; anova()       <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;(data.frame&#24418;&#24335;)</span>
aov(formula, data) |&gt; broom::tidy() <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;(tibble&#24418;&#24335;)</span>
aov(formula, data) |&gt; model.table(type = <span style="color: #d08928;">"means"</span>)   <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#24179;&#22343;&#20516;</span>
aov(formula, data) |&gt; model.table(type = <span style="color: #d08928;">"effects"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#21177;&#26524;(&#26082;&#23450;&#20516;)</span>
</pre>
</div></li>

</ul>
</section>
<section id="slide-org0424f95">
<h3 id="org0424f95">分散分析の計算 (検定のみ)</h3>
<ul>
<li><p>
基本書式 
</p>
<div class="org-src-container">

<pre class="src src-R">oneway.test(formula, data, subset, na.action, var.equal = <span style="color: #00aa80;">FALSE</span>)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> formula: &#24335;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> subset: subset&#12398;&#25351;&#23450;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> na.action: &#27424;&#25613;&#20516;&#12398;&#25201;&#12356;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> var.equal: &#31561;&#20998;&#25955;&#12434;&#20206;&#23450;&#12377;&#12427;&#22580;&#21512;&#12399; TRUE&#65292;&#27161;&#28310;&#12391;&#12399; Welch &#12398;&#36817;&#20284;&#12364;&#29992;&#12356;&#12425;&#12428;&#12427;</span>
</pre>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-org57a094d" data-background="#fef4f4">
<h2 id="org57a094d">実習</h2>
</section>
<section id="slide-org3da649e" data-background="#fef4f4">
<h3 id="org3da649e">練習問題</h3>
<ul>
<li>一元配置分散分析について確率シミュレーションを行いなさい．</li>
<li>東京の気候データ (<code>tokyo_weather.csv</code>) の
気温の項目について以下の問に答えよ．
<ul>
<li><p>
曜日ごとの気温の平均と分散を求めよ．
</p>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#36913;&#26085;&#12434;&#22240;&#23376;(factor)&#12392;&#12377;&#12427;&#12395;&#12399;&#20363;&#12360;&#12400;&#20197;&#19979;&#12398;&#12424;&#12358;&#12394;&#38917;&#30446;&#12434;&#21152;&#12360;&#12428;&#12400;&#12424;&#12356;</span>
tw_data <span style="color: #60aa00;">&lt;-</span> read_csv(<span style="color: #d08928;">"data/tokyo_weather.csv"</span>) |&gt;
  mutate(day_of_week = ordered(day_of_week, <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#26332;&#26085;&#12434;&#38918;&#24207;&#20184;&#12365;&#22240;&#23376;&#12395;&#12377;&#12427;</span>
                               levels = wday(1:7, label = <span style="color: #00aa80;">TRUE</span>))) 
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#38306;&#25968; wday() &#12398;&#20986;&#21147;&#12399;&#20351;&#29992;&#35328;&#35486;&#12395;&#20381;&#23384;&#12377;&#12427;&#12398;&#12391;&#65292;&#24375;&#21046;&#30340;&#12395;&#33521;&#35486;&#12395;&#12377;&#12427;&#12395;&#12399; locale &#12434;&#25351;&#23450;&#12375;&#12390;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> wday(..., locale = "en_US") &#12392;&#12377;&#12428;&#12400;&#33391;&#12356;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#30465;&#30053;&#24418;&#12434;&#29992;&#12356;&#12394;&#12356;&#22580;&#21512;&#12399; abbr &#12434;&#25351;&#23450;&#12377;&#12427;&#65294;&#20197;&#19979;&#12399;&#12489;&#12452;&#12484;&#35486;&#12398;&#20363;</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> wday(1:7, label = TRUE, abbr = FALSE, locale = "de_DE")</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#21033;&#29992;&#21487;&#33021;&#12394;locale(&#35328;&#35486;)&#12434;&#35519;&#12409;&#12427;&#12395;&#12399; stringi::stri_locale_list() &#12434;&#29992;&#12356;&#12427;</span>
</pre>
</div></li>
<li>曜日ごとに平均が異なるといえるかどうか分散分析を用いて検定しなさい．</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org947e945">
<h2 id="org947e945">二元配置</h2>
<div class="outline-text-2" id="text-org947e945">
</div>
</section>
<section id="slide-org2a5a193">
<h3 id="org2a5a193">二元配置の問題</h3>
<ul>
<li>因子が2種類ある場合
<ul>
<li>一方の因子の水準の平均値に差があるか否かを検定</li>
<li>もう一方の因子の水準で平均値に差があるかは不問</li>

</ul></li>
<li><p>
<span style="color:green;">複数の薬の治験の問題</span>
</p>
<blockquote>
<p>
複数の薬の効能を複数の被験者に投与する実験
</p>
<ul>
<li>&ldquo;薬の種類&rdquo;と&ldquo;被験者番号&rdquo;の2種類の因子</li>
<li>&ldquo;薬の種類&rdquo;という因子での薬の効能の差を検証したい</li>
<li>&ldquo;被験者番号&rdquo;という因子で効能に差があることは許容したい
(薬の効き目には個人差があると考えられるため)</li>

</ul>
</blockquote></li>

</ul>
</section>
<section id="slide-org451b3fd">
<h3 id="org451b3fd">二元配置のモデル</h3>
<ul>
<li>2種類の因子 \(A, B\)
<ul>
<li>因子 \(A\) には \(a\) 個の水準 : \(A_1,\dotsc,A_a\)</li>
<li>因子 \(B\) には \(b\) 個の水準 : \(B_1,\dotsc,B_b\)</li>
<li>因子 \(A,B\) の水準がそれぞれ \(A_i,B_j\) である観測値 : \(Y_{ij}\)</li>
<li><span style="color:orange;">各水準ごとに1つの観測値が得られる一番簡単な場合を想定</span></li>

</ul></li>
<li><p>
観測データのモデル
</p>
<blockquote>
<div>
\begin{equation}
  Y_{ij}=\alpha_i+\beta_j+\varepsilon_{ij}\quad
  (i=1,\dotsc,a;\;j=1,\dotsc,b).
\end{equation}

</div>
</blockquote></li>
<li>モデルの仮定
<ul>
<li>因子 \(A,B\) の水準 \(A_i,B_j\) における効果
\(\alpha_i,\beta_j\) は定数</li>
<li>\(\varepsilon_{ij}\) は独立同分布 (平均0, 分散 \(\sigma^2\) の正規分布)</li>

</ul></li>

</ul>
</section>
<section id="slide-org935dee3">
<h3 id="org935dee3">二元配置の例</h3>
<ul>
<li><span style="color:green;">複数の薬の治験の問題</span>
<ul>
<li>因子
<ul>
<li>因子 \(A\) : &ldquo;薬の種類&rdquo;</li>
<li>因子 \(B\) : &ldquo;被験者番号&rdquo;</li>

</ul></li>
<li>効果
<ul>
<li>\(\alpha_i\) : 薬 \(A_i\) の効能</li>
<li>\(\beta_j\) : 被験者 \(B_j\) 固有の薬の効きやすさ</li>

</ul></li>
<li>薬の効能に差があるか否かという検定</li>

</ul></li>

</ul>
</section>
<section id="slide-orge5de71b">
<h3 id="orge5de71b">二元配置の検定</h3>
<ul>
<li><p>
検定問題
</p>
<blockquote>
<p>
因子 \(A\) の各水準の効果に差があるか否かを検定する
</p>

<p>
(因子 \(B\) の効果は除いて検定したい)
</p>
</blockquote>
<ul>
<li>帰無仮説 : 因子 \(A\) の効果 \(\alpha_{i}\) に差はない</li>
<li><p>
対立仮説 : 因子 \(A\) の効果に差のあるものがある
</p>
<blockquote>
<div>
\begin{equation}
  H_0:\alpha_1=\cdots=\alpha_a\quad\text{vs}\quad
  H_1:\text{ある\(i_1,i_2\)に対して}\alpha_{i_1}\neq\alpha_{i_2}.
\end{equation}

</div>
</blockquote></li>

</ul></li>

</ul>
</section>
<section id="slide-org7947579">
<h3 id="org7947579">分析の考え方</h3>
<ul>
<li>データの変動から因子間での変動と観測誤差の変動を抽出して比較</li>
<li><p>
各種平均 (\(n=ab\))
</p>
<blockquote>
<div>
\begin{align}
  &\text{(全データの標本平均)}
  &\bar{Y}_{\cdot\cdot}&=\frac{1}{n}\sum_{i=1}^a\sum_{j=1}^{b}Y_{ij},\\
  &\text{(水準\(A_i\)の標本平均)}
  &\bar{Y}_{i\cdot}&=\frac{1}{b}\sum_{j=1}^bY_{ij}\quad
                     (i=1,\dotsc,a),\\
  &\text{(水準\(B_j\)の標本平均)}
  &\bar{Y}_{\cdot j}&=\frac{1}{a}\sum_{i=1}^aY_{ij}\quad
                      (j=1,\dotsc,b).
\end{align}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li><p>
因子効果の推定量としての標本平均
</p>
<blockquote>
<div>
\begin{align}
  \bar{Y}_{i\cdot}
  &\to\alpha_i+\frac{1}{b}\sum_{j=1}^b\beta_j,\\
  \bar{Y}_{\cdot j}
  &\to\frac{1}{a}\sum_{i=1}^a\alpha_i+\beta_j,\\
  \bar{Y}_{\cdot\cdot}
  &\to\frac{1}{ab}\sum_{i=1}^a\sum_{j=1}^b(\alpha_i+\beta_j)=\frac{1}{a}\sum_{i=1}^a\alpha_i+\frac{1}{b}\sum_{j=1}^b\beta_j
\end{align}

</div>
<div>
\begin{equation}
  Y_{ij}-\bar{Y}_{i\cdot}
  -\bar{Y}_{\cdot j}+\bar{Y}_{\cdot\cdot}
  \to\varepsilon_{ij}
\end{equation}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li><p>
各種変動
</p>
<blockquote>
<div>
\begin{align}
  &\text{(行間変動)}
  &SS_A&=b\sum_{i=1}^a(\bar{Y}_{i\cdot}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(列間変動)}
  &SS_B&=a\sum_{j=1}^b(\bar{Y}_{\cdot j}-\bar{Y}_{\cdot\cdot})^2,\\
  &\text{(誤差変動)}
  &SS_E&=\sum_{i=1}^a\sum_{j=1}^b(Y_{ij}-\bar{Y}_{i\cdot}
         -\bar{Y}_{\cdot j}+\bar{Y}_{\cdot\cdot})^2.
\end{align}

</div>
</blockquote>
<ul>
<li><b>行間変動</b> : 水準 \(A\) 内でのデータの変動</li>
<li><b>列間変動</b> : 水準 \(B\) 内でのデータの変動</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
変動の分解
</p>
<blockquote>
<div>
\begin{align}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }ab-1}
  =&\underbrace{\text{(行間変動) }SS_A}_{\text{自由度 }a-1}\\
  &+\underbrace{\text{(列間変動) }SS_B}_{\text{自由度 }b-1}
  +\underbrace{\text{(誤差変動) }SS_E}_{\text{自由度 }(a-1)(b-1)}
\end{align}

</div>
</blockquote></li>
<li>帰無仮説 \(H_0\) が正しい場合
<ul>
<li>変動 \(SS_A,SS_E\) はともに観測誤差のみが原因で生じる</li>
<li>自由度を除けば本質的な違いはない</li>
<li>\(SS_A/(a{-}1)\), \(SS_E/(a{-}1)(b{-}1)\) は \(\sigma^2\) の不偏推定量</li>

</ul></li>

</ul>

</section>
<section>
<ul>
<li><p>
変動の分解
</p>
<blockquote>
<div>
\begin{align}
  \underbrace{\text{(全変動) }SS_T}_{\text{自由度 }ab-1}
  =&\underbrace{\text{(行間変動) }SS_A}_{\text{自由度 }a-1}\\
  &+\underbrace{\text{(列間変動) }SS_B}_{\text{自由度 }b-1}
  +\underbrace{\text{(誤差変動) }SS_E}_{\text{自由度 }(a-1)(b-1)}
\end{align}

</div>
</blockquote></li>
<li>対立仮説 \(H_1\) が正しい場合
<ul>
<li>因子 \(A\) 内の水準間での効果 \(\alpha_1,\dotsc,\alpha_a\) の差に影響される</li>
<li>\(SS_A\) は \(SS_E\) より本質的に大きくなる</li>

</ul></li>

</ul>
</section>
<section id="slide-org8fd1d22">
<h3 id="org8fd1d22">二元配置の検定</h3>
<ul>
<li><p>
検定統計量
</p>
<blockquote>
<div>
\begin{equation}
  F_A=\frac{SS_A/(a{-}1)}{SS_E/(a{-}1)(b{-}1)}
\end{equation}

</div>
</blockquote></li>
<li>帰無仮説の下で次の事実が成り立つ
<ul>
<li>\(SS_A,SS_E\) は独立</li>
<li>\(SS_A\) は自由度 \(a{-}1\) の \(\chi^2\) 分布に従う</li>
<li>\(SS_E\) は自由度 \((a{-}1)(b{-}1)\) の \(\chi^2\) 分布に従う</li>

</ul></li>
<li>帰無仮説の下 \(F_A\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布に従う</li>
<li>対立仮説の下 \(F_A\) は大きな値をとるので右片側検定</li>

</ul>
</section>
<section id="slide-org6db3bfa">
<h3 id="org6db3bfa">棄却域を用いる場合</h3>
<ul>
<li>有意水準 : \(\alpha\in(0,1)\)</li>
<li>自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布
<ul>
<li>\(F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1))\) : \(1{-}\alpha\) 分位点</li>

</ul></li>
<li><p>
\(H_0\) の下で以下が成立
</p>
<blockquote>
<div>
\begin{equation}
  P(F_A>F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1)))=\alpha
\end{equation}

</div>
</blockquote></li>
<li><p>
第一種過誤の上限が \(\alpha\) となる棄却域
</p>
<blockquote>
<div>
\begin{equation}
  R_{\alpha}=
  (F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1)),\infty)
\end{equation}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li>データから検定統計量 \(F_A\) の値を計算</li>
<li><p>
以下の場合，帰無仮説を棄却
</p>
<blockquote>
<div>
\begin{equation}
  F_A>F_{1{-}\alpha}(a{-}1,(a{-}1)(b{-}1))
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orgf782f76">
<h3 id="orgf782f76">\(p\) 値を用いる場合</h3>
<ul>
<li><p>
\(p\) 値を計算 (右片側検定の場合の計算方法)
</p>
<blockquote>
<div>
\begin{equation}
  \text{(\(p\) 値)}=\int_{F_A}^\infty f(x)dx
\end{equation}

</div>
</blockquote>
<ul>
<li>\(f\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布の確率密度</li>

</ul></li>
<li>\(p\) 値が \(\alpha\) 未満なら帰無仮説を棄却</li>

</ul>
</section>
<section id="slide-org3a2293b">
<h3 id="org3a2293b">分散分析表 (二元配置の場合)</h3>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">&#xa0;</th>
<th scope="col" class="org-left">自由度</th>
<th scope="col" class="org-left">平方和</th>
<th scope="col" class="org-left">平均平方和</th>
<th scope="col" class="org-left">\(F\text{値}\)</th>
<th scope="col" class="org-left">\(p\text{値}\)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(\text{因子}A\)</td>
<td class="org-left">\(a{-}1\)</td>
<td class="org-left">\(SS_A\)</td>
<td class="org-left">\(\displaystyle\frac{SS_A}{a{-}1}\)</td>
<td class="org-left">\(F_A\)</td>
<td class="org-left">\(\displaystyle\int_{F_A}^\infty f(x)dx\)</td>
</tr>

<tr>
<td class="org-left">\(\text{因子}B\)</td>
<td class="org-left">\(b{-}1\)</td>
<td class="org-left">\(SS_B\)</td>
<td class="org-left">\(\displaystyle\frac{SS_B}{b{-}1}\)</td>
<td class="org-left">\(F_B\)</td>
<td class="org-left">\(\displaystyle\int_{F_B}^\infty f(x)dx\)</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">\(\text{誤差}\)</td>
<td class="org-left">\((a{-}1)(b{-}1)\)</td>
<td class="org-left">\(SS_E\)</td>
<td class="org-left">\(\displaystyle\frac{SS_E}{(a{-}1)(b{-}1)}\)</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<ul>
<li>\(f\) は自由度 \(a{-}1,(a{-}1)(b{-}1)\) の \(F\) 分布の確率密度</li>

</ul>
</section>
<section id="slide-orgd897cee">
<h3 id="orgd897cee">モデルの別表現</h3>
<p>
相対効果による定式化
</p>
<ul>
<li><p>
モデルの書き換え
</p>
<blockquote>
<div>
\begin{align}
  \mu^*&=\bar{\alpha}+\bar{\beta},&
                                    \alpha^*_i&=\alpha_i-\bar{\alpha},&
                                                                        \beta^*_j&=\beta_j-\bar{\beta}\\
       &&\bar{\alpha}&=\frac{1}{a}\sum_{i=1}^a\alpha_i,
                                              &\bar{\beta}&=\frac{1}{b}\sum_{j=1}^b\beta_j
\end{align}

</div>
<div>
\begin{equation}
  Y_{ij}=\mu^*+\alpha^*_i+\beta^*_j+\varepsilon_{ij}\quad
  (i=1,\dotsc,a;\;j=1,\dotsc,b)
\end{equation}

</div>
<div>
\begin{equation}
  \text{ただし }\sum_{i=1}^a\alpha^*_i=\sum_{j=1}^b\beta^*_j=0
\end{equation}

</div>
</blockquote></li>

</ul>

</section>
<section>
<ul>
<li><p>
帰無仮説 \(H_0\) は以下と同等
</p>
<blockquote>
<div>
\begin{equation}
  H_{0}:\alpha^*_1=\cdots=\alpha^*_a=0
\end{equation}

</div>
</blockquote></li>

</ul>
</section>
<section id="slide-orgea88b6c">
<h3 id="orgea88b6c">分散分析の計算</h3>
<ul>
<li><p>
基本書式 
</p>
<div class="org-src-container">

<pre class="src src-R">aov(formula, data)
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> formula: &#24335;&#65292;&#20108;&#20803;&#37197;&#32622;&#12398;&#22580;&#21512;&#12399; (&#35251;&#28204;&#20516; ~ &#22240;&#23376; + &#22240;&#23376;)</span>
<span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> data: &#12487;&#12540;&#12479;&#12501;&#12524;&#12540;&#12512;</span>
</pre>
</div></li>
<li>分散分析表なども同様</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgbba105f" data-background="#fef4f4">
<h2 id="orgbba105f">実習</h2>
</section>
<section id="slide-org6074ee4" data-background="#fef4f4">
<h3 id="org6074ee4">練習問題</h3>
<ul>
<li><p>
<code>package::datarium</code> に含まれている
<code>jobsatisfaction</code> データについて以下の問に答えよ．
</p>
<blockquote>
<p>
性別 (<code>gender</code>) と
学歴 (<code>education_level</code>) の違いによる
仕事の満足度 (<code>score</code>) を収集したデータ
</p>
</blockquote>
<ul>
<li>データを適当な方法で可視化しなさい．</li>
<li>それぞれの因子で満足度の平均に違いがあるか
二元配置の分散分析を用いて検討しなさい．</li>

</ul>
<div class="org-src-container">

<pre class="src src-R"><span style="color: #808080; font-weight: bold; font-style: italic;">#</span><span style="color: #808080; font-weight: bold; font-style: italic;">'</span><span style="color: #808080; font-style: italic;"> &#12497;&#12483;&#12465;&#12540;&#12472;&#12398;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12392;&#35501;&#12415;&#36796;&#12415;&#12399;&#20197;&#19979;&#12398;&#12424;&#12358;&#12395;&#34892;&#12358;&#12371;&#12392;&#12364;&#12391;&#12365;&#12427;</span>
install.packages(<span style="color: #d08928;">"datarium"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;</span>
<span style="color: #60aa00;">library</span>(<span style="color: #d08928;">"datarium"</span>) <span style="color: #808080; font-style: italic;"># </span><span style="color: #808080; font-style: italic;">&#35501;&#12415;&#36796;&#12415;</span>
</pre>
</div></li>

</ul>
</section>
</section>
<section>
<section id="slide-org42f1f90">
<h2 id="org42f1f90">次回の予定</h2>
<ul>
<li>回帰分析</li>
<li>回帰係数の推定
<ul>
<li>点推定</li>
<li>区間推定</li>

</ul></li>
<li>回帰係数の検定
<ul>
<li>係数の有意性</li>

</ul></li>
<li>決定係数</li>

</ul>
</div>
</div>
<script src="./reveal.js/dist/reveal.js"></script>
<script src="./reveal.js/plugin/notes/notes.js"></script>
<script src="./reveal.js/plugin/search/search.js"></script>
<script src="./reveal.js/plugin/zoom/zoom.js"></script>
<script src="./reveal.js/plugin/menu/menu.js"></script>
<script src="./reveal.js/plugin/spotlight/spotlight.js"></script>
<script src="./reveal.js/plugin/chalkboard/plugin.js"></script>
<script src="./reveal.js/dist/theme/hidelinks.js"></script>
<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: true,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
mouseWheel: false,
fragmentInURL: true,
hashOneBasedIndex: false,
pdfSeparateFragments: false,
overview: true,

transition: 'fade',
transitionSpeed: 'default',
showNotes: window.location.search.match( /print-pdf/gi ) ? 'separate-page' : false,
spotlight: { size: 80, initialPresentationMode: false, }, keyboard: { 81: function() { RevealSpotlight.toggleSpotlight()}, 87: function() { RevealSpotlight.togglePresentationMode();}, },

// Plugins with reveal.js 4.x
plugins: [ RevealNotes, RevealSearch, RevealZoom, RevealMenu, RevealSpotlight, RevealChalkboard ],

// Optional libraries used to extend reveal.js
dependencies: [
]

});
</script>
</body>
</html>
